<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, viewport-fit=cover" name="viewport" />
    <title>Trạm Năng Lượng - LevelUp Kids</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet" />
    <!-- Global CSS -->
    <link rel="stylesheet" href="../shared/css/global.css">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fast Image Hydration Hint -->
    <script>
        (function () {
            // Hydration logic
            console.log("System Hydrated");
        })();
    </script>
    <!-- Shared Scripts -->
    <script src="../shared/js/state.js?v=2.0.5"></script>
    <script src="../shared/js/components.js?v=2.0.9" defer></script>
    <!-- Theme Config -->
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ee9d2b",
                        "primary-dark": "#d48215",
                        "secondary": "#2c2215",
                    },
                    animation: {
                        'shine': 'shine 3s infinite linear',
                        'wiggle': 'wiggle 2s ease-in-out infinite',
                        'scroll': 'scroll linear infinite',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        shine: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(100%)' },
                        },
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-5deg)' },
                            '50%': { transform: 'rotate(5deg)' },
                        },
                        scroll: {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(-50%)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                },
            },
        };
    </script>
    <style>
        .power-orbit {
            position: absolute;
            border: 2px dashed rgba(238, 157, 43, 0.2);
            border-radius: 50%;
            pointer-events: none;
            display: none;
        }

        @media (min-width: 768px) {
            .power-orbit {
                display: block;
            }
        }

        .orbit-1 {
            width: 320px;
            height: 320px;
            animation: spin 20s linear infinite;
        }

        .orbit-2 {
            width: 500px;
            height: 500px;
            animation: spin 30s linear infinite reverse;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .victory-ticker-container {
            mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
            height: 48px;
            /* Fixed: Increased height to prevent text being cut off */
        }

        .animate-scroll {
            display: flex;
            width: max-content;
            align-items: center;
            height: 100%;
        }

        .hero-glow-bg {
            background: radial-gradient(circle at center, rgba(238, 157, 43, 0.15) 0%, transparent 70%);
        }

        .cute-card {
            background-color: white;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 2rem;
            padding: 1.25rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        @media (min-width: 768px) {
            .cute-card {
                border-radius: 3.5rem;
                padding: 2rem;
            }
        }

        .dark .cute-card {
            background-color: rgba(15, 23, 42, 0.8);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .cute-card:hover {
            transform: translateY(-0.75rem);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, rgba(255, 255, 255, 1) 0%, rgba(240, 240, 240, 1) 100%);
        }

        .dark .cute-card:hover {
            background: linear-gradient(135deg, rgba(30, 30, 35, 0.9) 0%, rgba(20, 20, 25, 0.9) 100%);
        }

        /* Unified Button Style */
        .btn-glass {
            margin-top: 1rem;
            height: 2.5rem;
            padding-left: 1.5rem;
            padding-right: 1.5rem;
            border-radius: 9999px;
            font-size: 10px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(12px);
            cursor: pointer;
        }

        @media (min-width: 768px) {
            .btn-glass {
                margin-top: 2.5rem;
                height: 3rem;
                padding-left: 2rem;
                padding-right: 2rem;
                font-size: 11px;
            }
        }

        .btn-glass:active {
            transform: scale(0.95);
        }

        /* Icon Container Style */
        .icon-bloom {
            width: 4rem;
            height: 4rem;
            border-radius: 999px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: all 0.5s;
            position: relative;
            z-index: 10;
            border: 3px solid rgba(255, 255, 255, 0.4);
        }

        @media (min-width: 768px) {
            .icon-bloom {
                width: 6rem;
                height: 6rem;
                border: 4px solid rgba(255, 255, 255, 0.4);
            }
        }

        .hero-avatar {
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        .group:hover .icon-bloom {
            transform: scale(1.1);
        }

        .icon-3d {
            width: 7rem;
            height: 7rem;
            object-fit: contain;
            margin-bottom: 1.5rem;
            transition: transform 0.3s;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 1000;
            color: rgba(30, 41, 59, 1);
            text-transform: uppercase;
            letter-spacing: -0.05em;
            font-style: italic;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        @media (min-width: 768px) {
            .section-title {
                font-size: 1.875rem;
                gap: 1.5rem;
            }
        }

        .dark .section-title {
            color: white;
        }

        /* Reward Tag Styles */
        .reward-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.2rem;
            padding: 0.15rem 0.3rem;
            border-radius: 0.6rem;
            font-size: 9px;
            font-weight: 800;
            text-transform: uppercase;
            white-space: nowrap;
            letter-spacing: 0.02em;
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
        }

        .reward-tag span:not(.material-symbols-outlined) {
            display: none;
        }

        @media (min-width: 768px) {
            .reward-tag {
                padding: 0.15rem 0.4rem;
            }

            .reward-tag span:not(.material-symbols-outlined) {
                display: inline;
            }
        }

        .dark .reward-tag {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.05);
        }

        .reward-tag i {
            font-size: 14px;
        }

        .tag-gold {
            color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
            border-color: rgba(245, 158, 11, 0.2);
        }

        .tag-xp {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.2);
        }

        .tag-sticker {
            color: #a855f7;
            background: rgba(168, 85, 247, 0.1);
            border-color: rgba(168, 85, 247, 0.2);
        }

        .tag-water {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.2);
        }

        /* Blue like header */
        .tag-personality {
            color: #f43f5e;
            background: rgba(244, 63, 94, 0.1);
            border-color: rgba(244, 63, 94, 0.2);
        }

        /* Rose like heart in header */
        .tag-bond {
            color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.2);
        }

        .tag-bet {
            color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
            border-color: rgba(245, 158, 11, 0.2);
        }

        .tag-glory {
            color: #facc15;
            background: rgba(250, 204, 21, 0.1);
            border-color: rgba(250, 204, 21, 0.2);
        }
    </style>
</head>

<body
    class="bg-slate-50 dark:bg-[#0f172a] font-['Montserrat'] text-slate-900 transition-colors duration-500 overflow-x-hidden">
    <!-- CRITICAL: Instant UI Hydration (Run before anything else) -->
    <script>
        (function () {
            const pid = localStorage.getItem('family_quest_active_profile');
            if (!pid) return;
            const cache = localStorage.getItem('family_quest_state_v3_cache_' + pid);
            if (!cache) return;
            try {
                const data = JSON.parse(cache);
                const user = data.user;
                if (!user) return;

                // Cập nhật DOM ngay lập tức bằng JS thuần để tránh "LOADING..." flash
                document.addEventListener('DOMContentLoaded', () => {
                    const nameEl = document.getElementById('hero-name');
                    const levelEl = document.getElementById('hero-level');
                    const avatarEl = document.getElementById('hero-avatar');

                    if (nameEl && user.name) nameEl.innerText = user.name;
                    if (levelEl && user.level) levelEl.innerText = user.level;
                    if (avatarEl && user.avatar) avatarEl.style.backgroundImage = 'url("' + user.avatar + '")';
                });
            } catch (e) { }
        })();
    </script>

    <!-- App Header -->
    <app-header></app-header>

    <!-- 1. VICTORY TICKER (BẢN TIN CHIẾN THẮNG) -->
    <div id="victory-ticker"
        class="fixed top-[92px] md:top-[96px] left-1/2 -translate-x-1/2 w-[95%] max-w-5xl z-[60] bg-white/40 dark:bg-black/40 backdrop-blur-3xl border border-white/30 dark:border-white/10 h-8 md:h-11 flex items-center overflow-hidden victory-ticker-container shadow-xl rounded-full transition-all duration-300">
        <div class="animate-scroll whitespace-nowrap gap-24 text-blue-600 dark:text-blue-300 font-extrabold text-[8px] md:text-[10px] uppercase tracking-[0.2em] px-12"
            style="animation-duration: 40s" id="ticker-content">
            <!-- Content dynamically generated by JS -->
        </div>
    </div>

    <main class="max-w-7xl mx-auto px-3 md:px-4 pt-28 md:pt-56 pb-32 space-y-8 md:space-y-24">


        <!-- 2. POWER CORE (TRUNG TÂM NĂNG LƯỢNG) -->
        <section id="hero-section"
            class="relative flex flex-col items-center justify-center py-2 md:py-10 animate-fade-in-up">
            <div class="hero-glow-bg absolute inset-0 -z-10 animate-pulse"></div>

            <!-- Orbits -->
            <div class="power-orbit orbit-1 flex items-center justify-center border-primary/20">
                <div class="size-8 bg-primary rounded-full blur-[2px] -translate-x-[160px] animate-pulse"></div>
            </div>
            <div class="power-orbit orbit-2 flex items-center justify-center border-blue-500/20">
                <div class="size-6 bg-blue-500 rounded-full blur-[2px] translate-x-[250px] animate-pulse"></div>
            </div>

            <!-- Avatar -->
            <div class="relative group cursor-pointer" onclick="window.location.href='../dashboard/index.html'">
                <div
                    class="absolute -inset-8 md:-inset-12 bg-gradient-to-tr from-primary via-amber-400 to-yellow-200 rounded-full blur-3xl opacity-20 group-hover:opacity-60 transition-opacity animate-aura">
                </div>
                <div id="hero-avatar"
                    class="size-32 md:size-80 rounded-[3rem] md:rounded-[5rem] bg-slate-200 dark:bg-slate-800 bg-cover bg-center border-4 md:border-8 border-white dark:border-slate-800 shadow-[0_25px_60px_-15px_rgba(0,0,0,0.3)] relative z-20 group-hover:scale-105 transition-all duration-500 group-hover:rotate-2 animate-pulse">
                    <div class="absolute -bottom-3 md:-bottom-6 -right-3 md:-right-6 bg-gradient-to-br from-primary to-amber-600 text-white size-12 md:size-24 rounded-[1.5rem] md:rounded-[3rem] flex flex-col items-center justify-center border-3 md:border-4 border-white dark:border-slate-800 shadow-2xl"
                        id="hero-level-ring">
                        <span
                            class="text-[8px] md:text-[10px] font-black uppercase tracking-tighter opacity-80">Cấp</span>
                        <span class="font-[1000] text-xl md:text-4xl leading-none mt-0.5 md:mt-1"
                            id="hero-level">&nbsp;</span>
                    </div>
                </div>

                <!-- Inner Hydration: Extra safety to catch elements during parse -->
                <script>
                    (function () {
                        const user = window._initialHydration;
                        if (!user) return;
                        const avatarEl = document.getElementById('hero-avatar');
                        const levelEl = document.getElementById('hero-level');
                        if (avatarEl && user.avatar) {
                            avatarEl.style.backgroundImage = 'url("' + user.avatar + '")';
                            avatarEl.classList.remove('animate-pulse');
                        }
                        if (levelEl && user.level) levelEl.innerText = user.level;
                    })();
                </script>
            </div>

            <!-- Identity -->
            <div class="mt-6 md:mt-16 text-center relative z-10">
                <h1 class="text-3xl sm:text-7xl md:text-9xl font-[1000] tracking-tighter uppercase italic text-slate-900 dark:text-white mb-2 md:mb-4 drop-shadow-2xl"
                    id="hero-name">&nbsp;</h1>
                <div
                    class="inline-flex items-center gap-3 md:gap-4 bg-white/70 dark:bg-black/40 backdrop-blur-2xl px-6 md:px-10 py-3 md:py-4 rounded-full border border-white/30 shadow-2xl">

                    <div
                        class="size-10 bg-gradient-to-br from-primary to-amber-500 rounded-xl flex items-center justify-center text-white shadow-lg overflow-hidden relative">
                        <span class="material-symbols-outlined text-2xl relative z-10"
                            style="font-variation-settings:'FILL' 1">workspace_premium</span>
                        <div class="absolute inset-0 bg-white/20 animate-shine"></div>
                    </div>
                    <span
                        class="font-[1000] tracking-[0.2em] text-xs md:text-sm uppercase text-slate-700 dark:text-slate-200"
                        id="hero-title">ĐANG QUÉT DANH HIỆU...</span>
                </div>
            </div>

            <!-- Status Bar -->
            <div class="mt-6 md:mt-14 w-full max-w-lg space-y-4 md:space-y-6">
                <div class="flex justify-between items-end px-6">
                    <span
                        class="text-[9px] md:text-[11px] font-black text-primary uppercase tracking-[0.2em] md:tracking-[0.5em] glow-text whitespace-nowrap">Hào
                        Quang Thủ Lĩnh</span>
                    <span class="text-sm font-black text-slate-500 dark:text-slate-400" id="hero-xp-text">0 / 100
                        XP</span>
                </div>
                <div
                    class="h-6 bg-slate-200 dark:bg-slate-800/60 rounded-full overflow-hidden p-1.5 shadow-inner border border-white/10">
                    <div id="hero-xp-bar"
                        class="h-full bg-gradient-to-r from-primary via-amber-400 to-amber-200 rounded-full shadow-[0_0_25px_rgba(238,157,43,0.6)] transition-all duration-[2s]"
                        style="width: 0%"></div>
                </div>
            </div>
        </section>

        <script>
            // Hide ticker when scrolled past avatar
            (function () {
                const ticker = document.getElementById('victory-ticker');
                if (!ticker) return;
                let ticking = false;
                window.addEventListener('scroll', function () {
                    if (!ticking) {
                        requestAnimationFrame(function () {
                            const avatar = document.getElementById('hero-avatar');
                            if (!avatar) { ticking = false; return; }
                            const avatarTop = avatar.getBoundingClientRect().top;
                            if (avatarTop < 120) {
                                ticker.style.opacity = '0';
                                ticker.style.pointerEvents = 'none';
                            } else {
                                ticker.style.opacity = '1';
                                ticker.style.pointerEvents = 'auto';
                            }
                            ticking = false;
                        });
                        ticking = true;
                    }
                }, { passive: true });
            })();
        </script>

        <!-- CATEGORY 1: HÀNH ĐỘNG ANH HÙNG -->
        <section class="animate-fade-in-up delay-100">
            <div class="flex items-center gap-2 md:gap-6 mb-3 md:mb-12">
                <h2 class="section-title text-base md:text-3xl whitespace-nowrap">HÀNH ĐỘNG <span
                        class="text-primary italic">ANH HÙNG</span></h2>
                <div class="h-px flex-1 bg-slate-200 dark:bg-white/10"></div>
                <span class="hidden md:inline text-[11px] font-black text-slate-400 tracking-[0.4em] uppercase">KIẾM VẬT
                    PHẨM</span>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-3 md:gap-10">

                <!-- Mission -->
                <a href="../dashboard/index.html"
                    class="cute-card group relative overflow-hidden flex flex-col items-center text-center">
                    <div class="mb-2 md:mb-8 relative flex items-center justify-center">
                        <div
                            class="hidden md:block absolute w-32 h-32 bg-amber-500/20 rounded-full blur-2xl top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 group-hover:scale-150 transition-transform duration-700">
                        </div>
                        <div class="icon-bloom bg-gradient-to-br from-amber-400 to-orange-500 group-hover:rotate-6">
                            <span class="material-symbols-outlined text-3xl md:text-5xl"
                                style="font-variation-settings:'FILL' 1">target</span>
                        </div>
                    </div>
                    <h3
                        class="text-base md:text-3xl font-[1000] mb-1 md:mb-4 text-slate-800 dark:text-white uppercase tracking-tight">
                        NHIỆM VỤ</h3>
                    <div class="flex flex-wrap justify-center gap-1 md:gap-2 mb-2">
                        <div class="reward-tag tag-gold"><span
                                class="material-symbols-outlined !text-[14px]">monetization_on</span><span
                                class="hidden md:inline">Vàng</span>
                        </div>
                        <div class="reward-tag tag-water"><span
                                class="material-symbols-outlined !text-[14px]">water_drop</span><span
                                class="hidden md:inline">Nước</span></div>
                        <div class="reward-tag tag-sticker"><span
                                class="material-symbols-outlined !text-[14px]">sell</span><span
                                class="hidden md:inline">Sticker</span></div>
                        <div class="reward-tag tag-xp"><span
                                class="material-symbols-outlined !text-[14px]">bolt</span><span
                                class="hidden md:inline">XP</span></div>
                    </div>
                    <div class="btn-glass bg-amber-500/10 text-amber-600 border-amber-500/20 !text-[9px] md:!text-[11px] !px-3 md:!px-8"
                        id="pending-count">0 ĐANG CHỜ</div>
                </a>
                <!-- Growth Diary -->
                <a href="../personality/index.html"
                    class="cute-card group relative overflow-hidden flex flex-col items-center text-center">
                    <div class="mb-2 md:mb-8 relative flex items-center justify-center">
                        <div
                            class="hidden md:block absolute w-32 h-32 bg-rose-500/20 rounded-full blur-2xl top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 group-hover:scale-150 transition-transform duration-700">
                        </div>
                        <div class="icon-bloom bg-gradient-to-br from-rose-400 to-pink-600 group-hover:-rotate-6">
                            <span class="material-symbols-outlined text-3xl md:text-5xl"
                                style="font-variation-settings:'FILL' 1">auto_stories</span>
                        </div>
                    </div>
                    <h3
                        class="text-base md:text-3xl font-[1000] mb-1 md:mb-4 text-slate-800 dark:text-white uppercase tracking-tight">
                        NHẬT KÝ</h3>
                    <div class="flex flex-wrap justify-center gap-1 md:gap-2 mb-2">
                        <div class="reward-tag tag-personality"><span
                                class="material-symbols-outlined !text-[14px]">favorite</span><span
                                class="hidden md:inline">Nhân Cách</span>
                        </div>
                        <div class="reward-tag tag-bond"><span
                                class="material-symbols-outlined !text-[14px]">auto_awesome</span><span
                                class="hidden md:inline">Đặc Quyền</span>
                        </div>
                    </div>
                    <div
                        class="btn-glass bg-rose-500/10 text-rose-600 border-rose-500/20 !text-[9px] md:!text-[11px] !px-3 md:!px-8">
                        VIẾT NHẬT KÝ</div>
                </a>
                <!-- Arena -->
                <a href="../arena/index.html"
                    class="cute-card group relative overflow-hidden flex flex-col items-center text-center col-span-2 md:col-span-1">
                    <div class="mb-2 md:mb-8 relative flex items-center justify-center">
                        <div
                            class="hidden md:block absolute w-32 h-32 bg-blue-500/20 rounded-full blur-2xl top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 group-hover:scale-150 transition-transform duration-700">
                        </div>
                        <div class="icon-bloom bg-gradient-to-br from-blue-400 to-indigo-600">
                            <span class="material-symbols-outlined text-3xl md:text-5xl"
                                style="font-variation-settings:'FILL' 1">swords</span>
                        </div>
                    </div>
                    <h3
                        class="text-base md:text-3xl font-[1000] mb-1 md:mb-4 text-slate-800 dark:text-white uppercase tracking-tight">
                        ĐẤU TRƯỜNG</h3>
                    <div class="flex flex-wrap justify-center gap-1 md:gap-1.5 mb-2">
                        <div class="reward-tag tag-bet"><span
                                class="material-symbols-outlined !text-[13px]">casino</span><span
                                class="hidden md:inline">Cược Vàng</span></div>
                        <div class="reward-tag tag-glory"><span
                                class="material-symbols-outlined !text-[13px]">local_fire_department</span><span
                                class="hidden md:inline">Chiến
                                Tích</span></div>
                        <div class="reward-tag tag-xp"><span
                                class="material-symbols-outlined !text-[13px]">military_tech</span><span
                                class="hidden md:inline">Bảng
                                Vàng</span></div>
                    </div>
                    <div class="btn-glass bg-blue-500/10 text-blue-600 border-blue-500/20 !text-[9px] md:!text-[11px] !px-3 md:!px-8"
                        id="arena-status">THÁCH ĐẤU</div>
                </a>
            </div>
        </section>

        <!-- CATEGORY: HÀNH TRÌNH KIÊN TRÌ (PERSISTENCE) -->
        <section class="animate-fade-in-up delay-150">
            <div class="flex items-center gap-2 md:gap-6 mb-4 md:mb-12">
                <h2 class="section-title whitespace-nowrap">HÀNH TRÌNH <span class="text-emerald-500 italic">KIÊN
                        TRÌ</span></h2>
                <div class="h-px flex-1 bg-slate-200 dark:bg-white/10"></div>
                <span
                    class="text-[8px] md:text-[11px] font-black text-slate-400 tracking-[0.2em] md:tracking-[0.4em] uppercase whitespace-nowrap">NUÔI
                    DƯỠNG</span>
            </div>

            <a href="../tree-growth/index.html"
                class="relative block bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl md:rounded-[4.5rem] p-5 md:p-12 overflow-hidden shadow-2xl group hover:scale-[1.01] transition-all">
                <div
                    class="absolute right-0 top-0 h-full w-1/3 bg-gradient-to-l from-emerald-500/5 to-transparent pointer-events-none">
                </div>

                <div class="relative z-10 flex flex-col md:flex-row items-center gap-4 md:gap-10">
                    <div class="relative shrink-0">
                        <div
                            class="absolute w-40 h-40 bg-emerald-500/20 rounded-full blur-3xl top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 group-hover:scale-125 transition-transform duration-700">
                        </div>
                        <div
                            class="icon-bloom bg-gradient-to-br from-emerald-400 to-teal-600 !size-20 md:!size-40 !rounded-[2rem] md:!rounded-[4rem]">
                            <span class="material-symbols-outlined text-6xl md:text-8xl"
                                style="font-variation-settings:'FILL' 1">park</span>
                        </div>
                    </div>

                    <div class="flex-1 text-center md:text-left">
                        <div
                            class="inline-flex items-center gap-2 bg-emerald-100 dark:bg-emerald-900/30 px-4 py-1.5 rounded-full text-emerald-600 dark:text-emerald-400 font-black text-[10px] uppercase tracking-widest mb-4">
                            <span class="size-1.5 bg-emerald-500 rounded-full animate-ping"></span>
                            Dự án lớn của con
                        </div>
                        <h3
                            class="text-2xl md:text-5xl font-[1000] text-slate-800 dark:text-white uppercase tracking-tight mb-2 md:mb-4 italic">
                            CÂY ĐẠI THỤ KIÊN TRÌ</h3>
                        <p
                            class="text-sm md:text-lg font-bold text-slate-500 dark:text-slate-400 italic leading-relaxed max-w-xl">
                            "Sức mạnh không nằm ở hành động một lần, mà ở sự bền bỉ tưới nước mỗi ngày."</p>
                    </div>

                    <div class="shrink-0 w-full md:w-auto">
                        <div class="btn-glass bg-emerald-500 text-white shadow-emerald-500/40 border-none md:scale-110 !mt-0 h-12 md:h-16 px-6 md:px-12 text-xs md:text-sm"
                            id="water-status">
                            0 GIỌT NƯỚC
                        </div>
                    </div>
                </div>
            </a>
        </section>

        <!-- CATEGORY 2: VINH DANH -->
        <section class="animate-fade-in-up delay-200">
            <div class="flex items-center gap-2 md:gap-6 mb-3 md:mb-12">
                <h2 class="section-title text-base md:text-3xl whitespace-nowrap">VINH DANH <span
                        class="text-blue-500 italic">ANH HÙNG NHÍ</span></h2>
                <div class="h-px flex-1 bg-slate-200 dark:bg-white/10"></div>
                <span class="hidden md:inline text-[11px] font-black text-slate-400 tracking-[0.4em] uppercase">VINH
                    DANH</span>
            </div>
            <div class="grid grid-cols-3 gap-2 md:gap-10">
                <!-- Stickers -->
                <a href="../sticker-book/index.html"
                    class="cute-card group flex flex-col items-center text-center !p-3 md:!p-8">
                    <div class="mb-2 md:mb-8 relative flex items-center justify-center">
                        <div
                            class="hidden md:block absolute w-32 h-32 bg-purple-500/15 rounded-full blur-2xl top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 group-hover:scale-150 transition-transform duration-700">
                        </div>
                        <div
                            class="icon-bloom bg-gradient-to-br from-purple-400 to-fuchsia-600 group-hover:animate-wiggle">
                            <span class="material-symbols-outlined text-3xl md:text-5xl"
                                style="font-variation-settings:'FILL' 1">sell</span>
                        </div>
                    </div>
                    <h3 class="text-xs md:text-2xl font-[1000] text-slate-800 dark:text-white uppercase tracking-tight">
                        STICKER</h3>
                    <div class="mt-1 md:mt-4 flex flex-col items-center">
                        <span class="text-xl md:text-4xl font-[1000] text-purple-600 dark:text-purple-400 italic"
                            id="stickers-stat">0</span>
                        <span class="text-[8px] md:text-[10px] font-black text-slate-400 uppercase tracking-wider">ĐÃ
                            MỞ</span>
                    </div>
                </a>
                <!-- Leaderboard -->
                <a href="../leaderboard/index.html"
                    class="cute-card group flex flex-col items-center text-center !p-3 md:!p-8">
                    <div class="mb-2 md:mb-8 relative flex items-center justify-center">
                        <div
                            class="hidden md:block absolute w-32 h-32 bg-sky-500/20 rounded-full blur-2xl top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 group-hover:scale-150 transition-transform duration-700">
                        </div>
                        <div class="icon-bloom bg-gradient-to-br from-sky-400 to-blue-600 group-hover:animate-float">
                            <span class="material-symbols-outlined text-3xl md:text-5xl"
                                style="font-variation-settings:'FILL' 1">emoji_events</span>
                        </div>
                    </div>
                    <h3 class="text-xs md:text-2xl font-[1000] text-slate-800 dark:text-white uppercase tracking-tight">
                        XẾP HẠNG</h3>
                    <div class="mt-1 md:mt-4 flex items-center justify-center gap-2 md:gap-6">
                        <div class="flex flex-col items-center">
                            <span class="text-xl md:text-4xl font-[1000] text-blue-600 dark:text-blue-400 italic"
                                id="rank-val">--</span>
                            <span
                                class="text-[8px] md:text-[9px] font-black text-slate-400 uppercase tracking-wider">BXH</span>
                        </div>
                    </div>
                </a>
                <!-- Achievements (Spotlight) -->
                <a href="../titles/index.html"
                    class="cute-card group flex flex-col items-center text-center relative !p-3 md:!p-8">
                    <div
                        class="hidden md:block absolute inset-0 bg-primary/5 opacity-0 group-hover:opacity-100 transition-opacity rounded-[2rem]">
                    </div>
                    <div class="mb-2 md:mb-8 relative flex items-center justify-center">
                        <div
                            class="absolute w-32 h-32 bg-primary/20 rounded-full blur-2xl top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 group-hover:scale-150 transition-transform duration-700">
                        </div>
                        <div class="icon-bloom bg-gradient-to-br from-primary to-amber-600 animate-float">
                            <span class="material-symbols-outlined text-5xl"
                                style="font-variation-settings:'FILL' 1">workspace_premium</span>
                            <div class="absolute inset-0 bg-gradient-to-tr from-white/20 to-transparent"></div>
                        </div>
                    </div>
                    <h3
                        class="text-xs md:text-2xl font-[1000] text-slate-800 dark:text-white uppercase tracking-tight relative z-10">
                        DANH HIỆU</h3>
                    <div class="mt-1 md:mt-6 flex flex-col items-center relative z-10">
                        <span
                            class="text-[11px] md:text-lg font-black text-primary uppercase italic text-center leading-tight"
                            id="latest-achievement">...</span>
                    </div>
                </a>
            </div>
        </section>

        <!-- CATEGORY 3: QUY ĐỔI (REDEEM) -->
        <section class="animate-fade-in-up delay-300">
            <!-- Mobile: Card style matching page -->
            <a href="../shop/index.html" class="block md:hidden">
                <div class="cute-card group !p-5 text-center relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-br from-primary/5 to-amber-500/5 pointer-events-none">
                    </div>
                    <div class="relative z-10">
                        <div class="mb-3 flex justify-center">
                            <div
                                class="icon-bloom bg-gradient-to-br from-primary to-amber-500 !size-16 group-hover:rotate-6">
                                <span class="material-symbols-outlined text-4xl"
                                    style="font-variation-settings:'FILL' 1">redeem</span>
                            </div>
                        </div>
                        <h3 class="text-lg font-[1000] text-slate-800 dark:text-white uppercase tracking-tight mb-1">CỬA
                            HÀNG <span class="text-primary">ANH HÙNG NHÍ</span></h3>
                        <p class="text-xs font-bold text-slate-400 italic mb-3">Đổi vàng lấy quà thần kỳ!</p>
                        <div
                            class="inline-flex items-center gap-2 bg-primary/10 px-4 py-2 rounded-xl border border-primary/20 mb-3">
                            <span class="material-symbols-outlined text-primary text-lg"
                                style="font-variation-settings:'FILL' 1">monetization_on</span>
                            <span class="text-xl font-[1000] text-primary italic" id="gold-stat-mobile">0 VÀNG</span>
                        </div>
                        <div class="btn-glass bg-primary text-white border-none shadow-primary/30 !mt-2 !text-[10px]">
                            VÀO KHO QUÀ</div>
                    </div>
                </div>
            </a>

            <!-- Desktop: Full gradient banner -->
            <a href="../shop/index.html"
                class="relative hidden md:block bg-gradient-to-r from-primary to-amber-600 rounded-[4.5rem] p-16 text-white overflow-hidden shadow-[0_30px_60px_-15px_rgba(238,157,43,0.4)] group hover:scale-[1.02] transition-transform">
                <div
                    class="absolute right-0 top-0 h-full w-2/5 opacity-15 pointer-events-none group-hover:scale-110 transition-transform duration-1000 flex items-center justify-center">
                    <span class="material-symbols-outlined text-[350px]">redeem</span>
                </div>
                <div class="relative z-10 flex flex-row items-center justify-between gap-12">
                    <div class="max-w-md">
                        <span
                            class="bg-white/30 backdrop-blur-md px-6 py-2 rounded-full text-[11px] font-black uppercase tracking-[0.4em] mb-8 inline-block">KHO
                            BÁU ELITE</span>
                        <h2 class="text-5xl font-[1000] tracking-tighter uppercase italic mb-6 leading-none">
                            CỬA HÀNG
                            <span class="text-amber-200">ANH HÙNG NHÍ</span>
                        </h2>
                        <p class="text-xl font-bold text-white/90 italic leading-relaxed">"Quy đổi công sức
                            làm việc tốt
                            của con thành những món quà thần kỳ!"</p>
                    </div>
                    <div class="flex flex-col items-end gap-8 shrink-0">
                        <div
                            class="bg-white/20 backdrop-blur-xl px-12 py-8 rounded-[3rem] border border-white/30 text-center shadow-xl">
                            <span class="block text-[11px] font-black uppercase tracking-widest mb-3 opacity-80">QUỸ
                                VÀNG CỦA CON</span>
                            <span class="text-6xl font-[1000] italic drop-shadow-lg" id="gold-stat">0
                                VÀNG</span>
                        </div>
                        <button
                            class="bg-white text-primary px-12 py-6 rounded-[2.5rem] font-[1000] text-lg uppercase tracking-widest shadow-2xl hover:bg-slate-900 hover:text-white transition-all transform hover:-translate-y-2 active:scale-95">VÀO
                            KHO QUÀ</button>
                    </div>
                </div>
            </a>
        </section>

    </main>

    <!-- Child Nav -->
    <child-nav active="home"></child-nav>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (!window.AppState) return;

            const renderStructuredDashboard = (data) => {
                const user = data.user;
                if (!user) return;

                // 1. Hero
                const heroAvatar = document.getElementById('hero-avatar');
                if (heroAvatar) heroAvatar.style.backgroundImage = `url('${user.avatar || ""}')`;
                document.getElementById('hero-name').innerText = user.name || "";
                document.getElementById('hero-level').innerText = user.level || "";
                document.getElementById('hero-title').innerText = `${data.title?.currentTitleName || ""}`;

                const xpPercent = Math.min(100, Math.floor(((user.xp || 0) / (user.maxXp || 100)) * 100));
                document.getElementById('hero-xp-text').innerText = `${user.xp || 0} / ${user.maxXp || 100} XP`;
                const xpBar = document.getElementById('hero-xp-bar');
                if (xpBar) xpBar.style.width = `${xpPercent}%`;

                // 2. Victory Ticker logic (REAL DATA)
                const buildTickers = () => {
                    const pool = [
                        `<div class="flex items-center gap-4"><span class="size-2 rounded-full bg-blue-500 animate-pulse"></span><span>${user.name} vừa nạm thêm năng lượng từ Nhật ký!</span></div>`,
                        `<div class="flex items-center gap-4"><span class="size-2 rounded-full bg-blue-500 animate-pulse"></span><span>Hạng #1 BXH hiện tại: ${data.leaderboard?.[0]?.name || 'Đang thống kê'}!</span></div>`,
                        `<div class="flex items-center gap-4"><span class="size-2 rounded-full bg-blue-500 animate-pulse"></span><span>Hệ thống vừa cập nhật nhiệm vụ mới dành riêng cho con!</span></div>`,
                        `<div class="flex items-center gap-4"><span class="size-2 rounded-full bg-blue-500 animate-pulse"></span><span>Danh hiệu hiện tại của con: ${data.title?.currentTitleName || 'Tân Binh'}</span></div>`,
                        `<div class="flex items-center gap-4"><span class="size-2 rounded-full bg-blue-500 animate-pulse"></span><span>Con đang có ${user.gold || 0} Vàng trong kho báu Elite!</span></div>`
                    ];
                    // Duplicate for seamless loop
                    return pool.join('<div class="w-12"></div>') + '<div class="w-12"></div>' + pool.join('<div class="w-12"></div>');
                };

                const tickerEl = document.getElementById('ticker-content');
                if (tickerEl) tickerEl.innerHTML = buildTickers();

                // 3. Category: Action
                const pending = data.missions?.filter(m => m.status === 'pending').length || 0;
                const pendingCountEl = document.getElementById('pending-count');
                if (pendingCountEl) {
                    pendingCountEl.innerText = `${pending} ĐANG CHỜ`;
                    pendingCountEl.className = pending > 0 ? "btn-glass bg-amber-500 text-white shadow-amber-500/40 border-none" : "btn-glass bg-amber-500/10 text-amber-600 border-amber-500/20";
                }

                const arenaStatusEl = document.getElementById('arena-status');
                if (arenaStatusEl) {
                    const isChallenged = user.challengesReceived?.length > 0;
                    arenaStatusEl.innerText = isChallenged ? "BỊ THÁCH ĐẤU!" : "THÁCH ĐẤU";
                    arenaStatusEl.className = isChallenged ? "btn-glass bg-red-500 text-white shadow-red-500/40 border-none animate-pulse" : "btn-glass bg-blue-500/10 text-blue-600 border-blue-500/20";
                }

                const waterStatusEl = document.getElementById('water-status');
                if (waterStatusEl) {
                    const water = user.water || 0;
                    waterStatusEl.innerText = `${water} GIỌT NƯỚC`;
                    waterStatusEl.className = water > 0 ? "btn-glass bg-emerald-500 text-white shadow-emerald-500/40 border-none" : "btn-glass bg-emerald-500/10 text-emerald-600 border-emerald-500/20";
                }

                // 4. Category: Showcase
                document.getElementById('stickers-stat').innerText = `${user.unlockedStickers?.length || 0}`;
                if (data.leaderboard) {
                    const sorted = [...data.leaderboard].sort((a, b) => (b.weeklyXp || 0) - (a.weeklyXp || 0));
                    const myRank = sorted.findIndex(p => p.id === user.id) + 1;
                    document.getElementById('rank-val').innerText = myRank > 0 ? `#${myRank}` : '--';
                }

                // Streak logic (from user challenges or mock for motivation)
                const streakEl = document.getElementById('streak-val');
                if (streakEl) {
                    const streak = user.winStreak || 0;
                    streakEl.innerText = streak;
                }

                // Latest Achievement logic
                const latestTitle = data.title?.currentTitleName || "Tân Binh";
                document.getElementById('latest-achievement').innerText = latestTitle;

                // 5. Category: Redeem
                document.getElementById('gold-stat').innerText = `${user.gold || 0} VÀNG`;
                const mobileGold = document.getElementById('gold-stat-mobile');
                if (mobileGold) mobileGold.innerText = `${user.gold || 0} VÀNG`;
            };

            renderStructuredDashboard(window.AppState);
            window.AppState.subscribe(renderStructuredDashboard);
        });
    </script>
</body>

</html>