<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Trạm Năng Lượng - LevelUp Kids</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet" />
    <!-- Global CSS -->
    <link rel="stylesheet" href="../shared/css/global.css">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-25..0"
        rel="stylesheet" />
    <!-- Shared Scripts -->
    <script src="../shared/js/state.js?v=1.1.0_CUTE_V2"></script>
    <script src="../shared/js/components.js?v=1.1.0" defer></script>
    <!-- Theme Config -->
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ee9d2b",
                        "primary-dark": "#d48215",
                        "secondary": "#2c2215",
                    },
                    animation: {
                        'shine': 'shine 3s infinite linear',
                        'wiggle': 'wiggle 2s ease-in-out infinite',
                        'scroll': 'scroll linear infinite',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        shine: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(100%)' },
                        },
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-5deg)' },
                            '50%': { transform: 'rotate(5deg)' },
                        },
                        scroll: {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(-50%)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                },
            },
        };
    </script>
    <style>
        .power-orbit {
            position: absolute;
            border: 2px dashed rgba(238, 157, 43, 0.2);
            border-radius: 50%;
            pointer-events: none;
        }

        .orbit-1 {
            width: 320px;
            height: 320px;
            animation: spin 20s linear infinite;
        }

        .orbit-2 {
            width: 500px;
            height: 500px;
            animation: spin 30s linear infinite reverse;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .victory-ticker-container {
            mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
            height: 48px;
            /* Fixed: Increased height to prevent text being cut off */
        }

        .animate-scroll {
            display: flex;
            width: max-content;
            align-items: center;
            height: 100%;
        }

        .hero-glow-bg {
            background: radial-gradient(circle at center, rgba(238, 157, 43, 0.15) 0%, transparent 70%);
        }

        .cute-card {
            background-color: white;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 3.5rem;
            padding: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .dark .cute-card {
            background-color: rgba(15, 23, 42, 0.8);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .cute-card:hover {
            transform: translateY(-0.75rem);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, rgba(255, 255, 255, 1) 0%, rgba(240, 240, 240, 1) 100%);
        }

        .dark .cute-card:hover {
            background: linear-gradient(135deg, rgba(30, 30, 35, 0.9) 0%, rgba(20, 20, 25, 0.9) 100%);
        }

        /* Unified Button Style */
        .btn-glass {
            margin-top: 2.5rem;
            height: 3rem;
            padding-left: 2rem;
            padding-right: 2rem;
            border-radius: 9999px;
            font-size: 11px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(12px);
            cursor: pointer;
        }

        .btn-glass:active {
            transform: scale(0.95);
        }

        /* Icon Container Style */
        .icon-bloom {
            width: 6rem;
            height: 6rem;
            border-radius: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            transition: all 0.5s;
            position: relative;
            z-index: 10;
            border: 4px solid rgba(255, 255, 255, 0.2);
        }

        .group:hover .icon-bloom {
            transform: scale(1.1);
        }

        .icon-3d {
            width: 7rem;
            height: 7rem;
            object-fit: contain;
            margin-bottom: 1.5rem;
            transition: transform 0.3s;
        }

        .section-title {
            font-size: 1.875rem;
            font-weight: 1000;
            color: rgba(30, 41, 59, 1);
            text-transform: uppercase;
            letter-spacing: -0.05em;
            font-style: italic;
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .dark .section-title {
            color: white;
        }
    </style>
</head>

<body
    class="bg-slate-50 dark:bg-[#0c0a08] min-h-screen text-slate-800 dark:text-slate-200 font-['Montserrat'] selection:bg-primary selection:text-white transition-colors duration-300">

    <!-- App Header -->
    <app-header></app-header>

    <!-- 1. VICTORY TICKER (BẢN TIN CHIẾN THẮNG) -->
    <div
        class="fixed top-[88px] left-1/2 -translate-x-1/2 w-[95%] max-w-5xl z-40 bg-white/10 dark:bg-black/20 backdrop-blur-2xl border border-white/20 dark:border-white/5 h-12 flex items-center overflow-hidden victory-ticker-container shadow-2xl rounded-full">
        <div class="animate-scroll whitespace-nowrap gap-24 text-blue-400 dark:text-blue-300 font-black text-xs uppercase tracking-widest px-12"
            style="animation-duration: 40s" id="ticker-content">
            <!-- Content dynamically generated by JS -->
        </div>
    </div>

    <main class="max-w-7xl mx-auto px-4 pt-56 pb-32 space-y-24">

        <!-- 2. POWER CORE (TRUNG TÂM NĂNG LƯỢNG) -->
        <section class="relative flex flex-col items-center justify-center py-10 animate-fade-in-up">
            <div class="hero-glow-bg absolute inset-0 -z-10 animate-pulse"></div>

            <!-- Orbits -->
            <div class="power-orbit orbit-1 flex items-center justify-center border-primary/20">
                <div class="size-8 bg-primary rounded-full blur-[2px] -translate-x-[160px] animate-pulse"></div>
            </div>
            <div class="power-orbit orbit-2 flex items-center justify-center border-blue-500/20">
                <div class="size-6 bg-blue-500 rounded-full blur-[2px] translate-x-[250px] animate-pulse"></div>
            </div>

            <!-- Avatar -->
            <div class="relative group cursor-pointer" onclick="window.location.href='../dashboard/index.html'">
                <div
                    class="absolute -inset-12 bg-gradient-to-tr from-primary via-amber-400 to-yellow-200 rounded-full blur-3xl opacity-20 group-hover:opacity-60 transition-opacity animate-aura">
                </div>
                <div id="hero-avatar"
                    class="size-56 md:size-80 rounded-[5rem] bg-cover bg-center border-8 border-white dark:border-slate-800 shadow-[0_25px_60px_-15px_rgba(0,0,0,0.3)] relative z-20 group-hover:scale-105 transition-all duration-500 group-hover:rotate-2">
                    <div class="absolute -bottom-6 -right-6 bg-gradient-to-br from-primary to-amber-600 text-white size-20 md:size-24 rounded-[2.5rem] md:rounded-[3rem] flex flex-col items-center justify-center border-4 border-white dark:border-slate-800 shadow-2xl"
                        id="hero-level-ring">
                        <span class="text-[10px] font-black uppercase tracking-tighter opacity-80">Cấp</span>
                        <span class="font-[1000] text-3xl md:text-4xl leading-none mt-1" id="hero-level">1</span>
                    </div>
                </div>
            </div>

            <!-- Identity -->
            <div class="mt-16 text-center relative z-10">
                <h1 class="text-7xl md:text-9xl font-[1000] tracking-tighter uppercase italic text-slate-900 dark:text-white mb-4 drop-shadow-2xl"
                    id="hero-name">ALEX</h1>
                <div
                    class="inline-flex items-center gap-4 bg-white/70 dark:bg-black/40 backdrop-blur-2xl px-10 py-4 rounded-full border border-white/30 shadow-2xl">
                    <div
                        class="size-10 bg-gradient-to-br from-primary to-amber-500 rounded-xl flex items-center justify-center text-white shadow-lg overflow-hidden relative">
                        <span class="material-symbols-outlined text-2xl relative z-10"
                            style="font-variation-settings:'FILL' 1">workspace_premium</span>
                        <div class="absolute inset-0 bg-white/20 animate-shine"></div>
                    </div>
                    <span
                        class="font-[1000] tracking-[0.2em] text-xs md:text-sm uppercase text-slate-700 dark:text-slate-200"
                        id="hero-title">ĐANG QUÉT DANH HIỆU...</span>
                </div>
            </div>

            <!-- Status Bar -->
            <div class="mt-14 w-full max-w-lg space-y-6">
                <div class="flex justify-between items-end px-6">
                    <span class="text-[11px] font-black text-primary uppercase tracking-[0.5em] glow-text">Hào Quang Thủ
                        Lĩnh</span>
                    <span class="text-sm font-black text-slate-500 dark:text-slate-400" id="hero-xp-text">0 / 100
                        XP</span>
                </div>
                <div
                    class="h-6 bg-slate-200 dark:bg-slate-800/60 rounded-full overflow-hidden p-1.5 shadow-inner border border-white/10">
                    <div id="hero-xp-bar"
                        class="h-full bg-gradient-to-r from-primary via-amber-400 to-amber-200 rounded-full shadow-[0_0_25px_rgba(238,157,43,0.6)] transition-all duration-[2s]"
                        style="width: 0%"></div>
                </div>
            </div>
        </section>

        <!-- CATEGORY 1: HÀNH ĐỘNG KIẾM VẬT PHẨM (ACTION) -->
        <section class="animate-fade-in-up delay-100">
            <div class="flex items-center gap-6 mb-12">
                <h2 class="section-title">HÀNH ĐỘNG <span class="text-primary italic">ANH HÙNG</span></h2>
                <div class="h-px flex-1 bg-slate-200 dark:bg-white/10"></div>
                <span class="text-[11px] font-black text-slate-400 tracking-[0.4em] uppercase">KIẾM VẬT PHẨM</span>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                <!-- Mission -->
                <a href="../dashboard/index.html"
                    class="cute-card group relative overflow-hidden flex flex-col items-center text-center">
                    <div class="mb-8 relative flex items-center justify-center">
                        <div
                            class="absolute inset-0 bg-amber-500/20 rounded-full blur-3xl group-hover:scale-150 transition-transform duration-700">
                        </div>
                        <div
                            class="icon-bloom bg-gradient-to-br from-amber-400 to-orange-500 shadow-amber-500/30 group-hover:rotate-6">
                            <span class="material-symbols-outlined text-5xl"
                                style="font-variation-settings:'FILL' 1">target</span>
                            <div
                                class="absolute inset-x-0 bottom-0 h-1/2 bg-gradient-to-t from-black/20 to-transparent">
                            </div>
                        </div>
                    </div>
                    <h3 class="text-3xl font-[1000] mb-4 text-slate-800 dark:text-white uppercase tracking-tight">NHIỆM
                        VỤ</h3>
                    <p class="text-sm font-bold text-slate-500 dark:text-slate-400 italic">"Tích lũy vàng, exp, sticker
                        & giọt nước"</p>
                    <div class="btn-glass bg-amber-500/10 text-amber-600 border-amber-500/20" id="pending-count">
                        0 ĐANG CHỜ
                    </div>
                </a>
                <!-- Growth Diary -->
                <a href="../personality/index.html"
                    class="cute-card group relative overflow-hidden flex flex-col items-center text-center">
                    <div class="mb-8 relative flex items-center justify-center">
                        <div
                            class="absolute inset-0 bg-rose-500/20 rounded-full blur-3xl group-hover:scale-150 transition-transform duration-700">
                        </div>
                        <div
                            class="icon-bloom bg-gradient-to-br from-rose-400 to-pink-600 shadow-rose-500/30 group-hover:-rotate-6">
                            <span class="material-symbols-outlined text-5xl"
                                style="font-variation-settings:'FILL' 1">auto_stories</span>
                            <div
                                class="absolute inset-x-0 bottom-0 h-1/2 bg-gradient-to-t from-black/20 to-transparent">
                            </div>
                        </div>
                    </div>
                    <h3 class="text-3xl font-[1000] mb-4 text-slate-800 dark:text-white uppercase tracking-tight">NHẬT
                        KÝ</h3>
                    <p class="text-sm font-bold text-slate-500 dark:text-slate-400 italic">"Soi chiếu tâm hồn, nhận Điểm
                        Nhân Cách."</p>
                    <div class="btn-glass bg-rose-500/10 text-rose-600 border-rose-500/20">
                        VIẾT NHẬT KÝ
                    </div>
                </a>
                <!-- Arena -->
                <a href="../arena/index.html"
                    class="cute-card group relative overflow-hidden flex flex-col items-center text-center">
                    <div class="mb-8 relative flex items-center justify-center">
                        <div
                            class="absolute inset-0 bg-blue-500/20 rounded-full blur-3xl group-hover:scale-150 transition-transform duration-700">
                        </div>
                        <div class="icon-bloom bg-gradient-to-br from-blue-400 to-indigo-600 shadow-blue-500/30">
                            <span class="material-symbols-outlined text-5xl"
                                style="font-variation-settings:'FILL' 1">swords</span>
                            <div
                                class="absolute inset-x-0 bottom-0 h-1/2 bg-gradient-to-t from-black/20 to-transparent">
                            </div>
                        </div>
                    </div>
                    <h3 class="text-3xl font-[1000] mb-4 text-slate-800 dark:text-white uppercase tracking-tight">ĐẤU
                        TRƯỜNG</h3>
                    <p class="text-sm font-bold text-slate-500 dark:text-slate-400 italic">"Giao lưu bản lĩnh, thăng cấp
                        kỹ năng."</p>
                    <div class="btn-glass bg-blue-500/10 text-blue-600 border-blue-500/20" id="arena-status">
                        ĐANG CHỜ KÈO...
                    </div>
                </a>
            </div>
        </section>

        <!-- CATEGORY 2: TRƯNG BÀY VINH QUANG (SHOWCASE) -->
        <section class="animate-fade-in-up delay-200">
            <div class="flex items-center gap-6 mb-12">
                <h2 class="section-title">VINH DANH <span class="text-blue-500 italic">ANH HÙNG NHÍ</span></h2>
                <div class="h-px flex-1 bg-slate-200 dark:bg-white/10"></div>
                <span class="text-[11px] font-black text-slate-400 tracking-[0.4em] uppercase">VINH DANH</span>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
                <!-- Stickers -->
                <a href="../sticker-book/index.html" class="cute-card group flex flex-col items-center text-center">
                    <div class="mb-8 relative flex items-center justify-center">
                        <div
                            class="absolute inset-0 bg-purple-500/10 rounded-full blur-2xl group-hover:scale-150 transition-transform duration-700">
                        </div>
                        <div
                            class="icon-bloom bg-gradient-to-br from-purple-400 to-fuchsia-600 shadow-purple-500/30 group-hover:animate-wiggle">
                            <span class="material-symbols-outlined text-5xl"
                                style="font-variation-settings:'FILL' 1">sell</span>
                            <div
                                class="absolute inset-x-0 bottom-0 h-1/2 bg-gradient-to-t from-black/10 to-transparent">
                            </div>
                        </div>
                    </div>
                    <h3 class="text-2xl font-[1000] text-slate-800 dark:text-white uppercase tracking-tight">BỘ SƯU TẬP
                    </h3>
                    <div class="mt-4 flex flex-col items-center">
                        <span class="text-4xl font-[1000] text-purple-600 dark:text-purple-400 italic"
                            id="stickers-stat">0</span>
                        <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">STICKER ĐÃ
                            MỞ</span>
                    </div>
                </a>
                <!-- Leaderboard -->
                <a href="../leaderboard/index.html" class="cute-card group flex flex-col items-center text-center">
                    <div class="mb-8 relative flex items-center justify-center">
                        <div
                            class="absolute inset-0 bg-sky-500/10 rounded-full blur-2xl group-hover:scale-150 transition-transform duration-700">
                        </div>
                        <div
                            class="icon-bloom bg-gradient-to-br from-sky-400 to-blue-600 shadow-blue-500/30 group-hover:animate-float">
                            <span class="material-symbols-outlined text-5xl"
                                style="font-variation-settings:'FILL' 1">emoji_events</span>
                            <div
                                class="absolute inset-x-0 bottom-0 h-1/2 bg-gradient-to-t from-black/10 to-transparent">
                            </div>
                        </div>
                    </div>
                    <h3 class="text-2xl font-[1000] text-slate-800 dark:text-white uppercase tracking-tight">SIÊU SAO
                        BẢNG VÀNG</h3>
                    <div class="mt-4 flex flex-col items-center">
                        <span class="text-4xl font-[1000] text-blue-600 dark:text-blue-400 italic"
                            id="rank-val">--</span>
                        <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">THỨ HẠNG HIỆN
                            TẠI</span>
                    </div>
                </a>
                <!-- Achievements (Spotlight) -->
                <div
                    class="cute-card group flex flex-col items-center text-center bg-gradient-to-br from-slate-900 to-slate-800 border-none relative overflow-hidden">
                    <div class="absolute inset-0 bg-primary/10 opacity-0 group-hover:opacity-100 transition-opacity">
                    </div>
                    <div class="mb-8 relative flex items-center justify-center">
                        <div
                            class="absolute inset-0 bg-primary/20 rounded-full blur-2xl group-hover:scale-150 transition-transform duration-700">
                        </div>
                        <div
                            class="icon-bloom bg-gradient-to-br from-primary to-amber-600 shadow-primary/40 animate-float">
                            <span class="material-symbols-outlined text-5xl"
                                style="font-variation-settings:'FILL' 1">workspace_premium</span>
                            <div class="absolute inset-0 bg-gradient-to-tr from-white/20 to-transparent"></div>
                        </div>
                    </div>
                    <h3 class="text-2xl font-[1000] text-white uppercase tracking-tight relative z-10">DANH HIỆU TỰ HÀO
                    </h3>
                    <div class="mt-6 flex flex-col items-center relative z-10">
                        <span class="text-lg font-black text-primary uppercase italic text-center px-4"
                            id="latest-achievement">...</span>
                        <p class="text-[9px] font-bold text-white/50 uppercase tracking-[0.2em] mt-3">Danh hiệu mới nhất
                            đã đạt được</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- CATEGORY 3: QUY ĐỔI (REDEEM) -->
        <section class="animate-fade-in-up delay-300">
            <a href="../shop/index.html"
                class="relative block bg-gradient-to-r from-primary to-amber-600 rounded-[4.5rem] p-16 text-white overflow-hidden shadow-[0_30px_60px_-15px_rgba(238,157,43,0.4)] group hover:scale-[1.02] transition-transform">
                <div
                    class="absolute right-0 top-0 h-full w-2/5 opacity-15 pointer-events-none group-hover:scale-110 transition-transform duration-1000 flex items-center justify-center">
                    <span class="material-symbols-outlined text-[350px]">redeem</span>
                </div>
                <div class="relative z-10 flex flex-col md:flex-row md:items-center justify-between gap-12">
                    <div class="max-w-md">
                        <span
                            class="bg-white/30 backdrop-blur-md px-6 py-2 rounded-full text-[11px] font-black uppercase tracking-[0.4em] mb-8 inline-block">KHO
                            BÁU ELITE</span>
                        <h2 class="text-6xl font-[1000] tracking-tighter uppercase italic mb-6 leading-none">CỬA HÀNG
                            <br><span class="text-amber-200">WINNER</span>
                        </h2>
                        <p class="text-xl font-bold text-white/90 italic leading-relaxed">"Quy đổi công sức làm việc tốt
                            của con thành những món quà thần kỳ!"</p>
                    </div>
                    <div class="flex flex-col items-center md:items-end gap-8 shrink-0">
                        <div
                            class="bg-white/20 backdrop-blur-xl px-12 py-8 rounded-[3rem] border border-white/30 text-center shadow-xl">
                            <span class="block text-[11px] font-black uppercase tracking-widest mb-3 opacity-80">QUỸ
                                VÀNG CỦA CON</span>
                            <span class="text-6xl font-[1000] italic drop-shadow-lg" id="gold-stat">0 VÀNG</span>
                        </div>
                        <button
                            class="bg-white text-primary px-12 py-6 rounded-[2.5rem] font-[1000] text-lg uppercase tracking-widest shadow-2xl hover:bg-slate-900 hover:text-white transition-all transform hover:-translate-y-2 active:scale-95">VÀO
                            KHO QUÀ BIẾN HÌNH</button>
                    </div>
                </div>
            </a>
        </section>

    </main>

    <!-- Child Nav -->
    <child-nav active="home"></child-nav>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (!window.AppState) return;

            const renderStructuredDashboard = (data) => {
                const user = data.user;
                if (!user) return;

                // 1. Hero
                const heroAvatar = document.getElementById('hero-avatar');
                if (heroAvatar) heroAvatar.style.backgroundImage = `url('${user.avatar || "../shared/assets/avatar_1.png"}')`;
                document.getElementById('hero-name').innerText = user.name || "ALEX";
                document.getElementById('hero-level').innerText = user.level || "1";
                document.getElementById('hero-title').innerText = `${data.title?.currentTitleName || "TÂN BINH KHỞI ĐẦU"}`;

                const xpPercent = Math.min(100, Math.floor(((user.xp || 0) / (user.maxXp || 100)) * 100));
                document.getElementById('hero-xp-text').innerText = `${user.xp || 0} / ${user.maxXp || 100} XP`;
                const xpBar = document.getElementById('hero-xp-bar');
                if (xpBar) xpBar.style.width = `${xpPercent}%`;

                // 2. Victory Ticker logic (REAL DATA)
                const buildTickers = () => {
                    const pool = [
                        `<div class="flex items-center gap-4"><span class="size-2 rounded-full bg-blue-500 animate-pulse"></span><span>${user.name} vừa nạm thêm năng lượng từ Nhật ký!</span></div>`,
                        `<div class="flex items-center gap-4"><span class="size-2 rounded-full bg-blue-500 animate-pulse"></span><span>Hạng #1 BXH hiện tại: ${data.leaderboard?.[0]?.name || 'Đang thống kê'}!</span></div>`,
                        `<div class="flex items-center gap-4"><span class="size-2 rounded-full bg-blue-500 animate-pulse"></span><span>Hệ thống vừa cập nhật nhiệm vụ mới dành riêng cho con!</span></div>`,
                        `<div class="flex items-center gap-4"><span class="size-2 rounded-full bg-blue-500 animate-pulse"></span><span>Danh hiệu hiện tại của con: ${data.title?.currentTitleName || 'Tân Binh'}</span></div>`,
                        `<div class="flex items-center gap-4"><span class="size-2 rounded-full bg-blue-500 animate-pulse"></span><span>Con đang có ${user.gold || 0} Vàng trong kho báu Elite!</span></div>`
                    ];
                    // Duplicate for seamless loop
                    return pool.join('<div class="w-12"></div>') + '<div class="w-12"></div>' + pool.join('<div class="w-12"></div>');
                };

                const tickerEl = document.getElementById('ticker-content');
                if (tickerEl) tickerEl.innerHTML = buildTickers();

                // 3. Category: Action
                const pending = data.missions?.filter(m => m.status === 'pending').length || 0;
                const pendingCountEl = document.getElementById('pending-count');
                if (pendingCountEl) {
                    pendingCountEl.innerText = `${pending} ĐANG CHỜ`;
                    pendingCountEl.className = pending > 0 ? "btn-glass bg-amber-500 text-white shadow-amber-500/40 border-none" : "btn-glass bg-amber-500/10 text-amber-600 border-amber-500/20";
                }

                const arenaStatusEl = document.getElementById('arena-status');
                if (arenaStatusEl) {
                    const isChallenged = user.challengesReceived?.length > 0;
                    arenaStatusEl.innerText = isChallenged ? "BỊ THÁCH ĐẤU!" : "ĐANG CHỜ KÈO...";
                    arenaStatusEl.className = isChallenged ? "btn-glass bg-red-500 text-white shadow-red-500/40 border-none animate-pulse" : "btn-glass bg-blue-500/10 text-blue-600 border-blue-500/20";
                }

                // 4. Category: Showcase
                document.getElementById('stickers-stat').innerText = `${user.unlockedStickers?.length || 0}`;
                if (data.leaderboard) {
                    const sorted = [...data.leaderboard].sort((a, b) => (b.totalStickers || 0) - (a.totalStickers || 0));
                    const myRank = sorted.findIndex(p => p.id === user.id) + 1;
                    document.getElementById('rank-val').innerText = myRank > 0 ? `#${myRank}` : '--';
                }

                // Latest Achievement logic
                const latestTitle = data.title?.currentTitleName || "Tân Binh";
                document.getElementById('latest-achievement').innerText = latestTitle;

                // 5. Category: Redeem
                document.getElementById('gold-stat').innerText = `${user.gold || 0} VÀNG`;
            };

            renderStructuredDashboard(window.AppState);
            window.AppState.subscribe(renderStructuredDashboard);
        });
    </script>
</body>

</html>