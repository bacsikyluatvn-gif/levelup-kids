<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>LevelUp Kids - Child Dashboard</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&amp;display=swap"
        rel="stylesheet" />
    <!-- Fonts & Icons (Loaded in Shared CSS) -->
    <link rel="stylesheet" href="../shared/css/global.css">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Shared Scripts -->
    <script src="../shared/js/state.js?v=1.0.5_FORCE"></script>
    <script src="../shared/js/components.js?v=1.0.7" defer></script>
    <!-- Theme Config -->
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: { "primary": "#ee9d2b", "primary-dark": "#d48215", "text-main": "#181511", "text-muted": "#897961" }
                }
            }
        }
    </script>
</head>

<body class="bg-slate-50 dark:bg-[#221a10] font-['Montserrat'] text-text-main min-h-screen flex flex-col">

    <!-- Reusable Header Component -->
    <app-header title="LevelUp Kids" type="child"></app-header>

    <!-- Main Content -->
    <main class="flex-grow w-full max-w-[1200px] mx-auto p-6 md:p-8">
        <!-- Welcome Section -->
        <div>
            <h2 class="text-3xl lg:text-4xl font-black text-slate-800 dark:text-white mb-2">
                Cu·ªôc phi√™u l∆∞u ƒëang ch·ªù, <span id="user-greeting-name">Alex</span>! üöÄ
            </h2>
            <p class="text-lg text-slate-500 font-medium" id="task-greeting-count">ƒêang t·∫£i nhi·ªám v·ª•...</p>
        </div>

        <!-- Streak Badges -->
        <div class="flex flex-col sm:flex-row items-center gap-3 mt-10">
            <!-- Action Streak Badge -->
            <div class="flex items-center gap-3 bg-white dark:bg-[#2c2215] px-4 py-2.5 rounded-2xl border border-slate-100 dark:border-slate-800 shadow-sm animate-bounce-subtle"
                title="S·ªë ng√†y li√™n ti·∫øp c√≥ ho·∫°t ƒë·ªông l√†m nhi·ªám v·ª•">
                <div
                    class="bg-blue-100 dark:bg-blue-900/30 p-2 rounded-xl text-blue-500 flex items-center justify-center">
                    <span class="material-symbols-outlined text-2xl">electric_bolt</span>
                </div>
                <div>
                    <p class="text-[10px] font-black uppercase tracking-widest text-slate-400">Chu·ªói H√†nh ƒê·ªông</p>
                    <p class="text-lg font-black text-slate-800 dark:text-white"><span class="text-blue-500"
                            id="stat-action-streak">12</span> <span class="text-sm">Ng√†y</span></p>
                </div>
            </div>

            <!-- Completion Streak Badge -->
            <div class="flex items-center gap-3 bg-white dark:bg-[#2c2215] px-4 py-2.5 rounded-2xl border border-slate-100 dark:border-slate-800 shadow-sm animate-bounce-subtle"
                title="S·ªë ng√†y li√™n ti·∫øp ho√†n th√†nh 100% nhi·ªám v·ª•">
                <div
                    class="bg-orange-100 dark:bg-orange-900/30 p-2 rounded-xl text-orange-500 flex items-center justify-center">
                    <span class="material-symbols-outlined text-2xl">local_fire_department</span>
                </div>
                <div>
                    <p class="text-[10px] font-black uppercase tracking-widest text-slate-400">Chu·ªói Ho√†n Th√†nh</p>
                    <p class="text-lg font-black text-slate-800 dark:text-white"><span class="text-orange-500"
                            id="stat-completion-streak">4</span> <span class="text-sm">Ng√†y</span></p>
                </div>
            </div>
        </div>

        <!-- Quests Grid with Reusable Card Components -->
        <div class="mt-12">
            <quest-grid></quest-grid>
        </div>
        <!-- Completed Tasks Section -->
        <completed-tasks></completed-tasks>
        <!-- Weekly Progress Mini Section -->
        <div id="weekly-progress-section"
            class="mt-12 bg-white dark:bg-[#2c2215] rounded-3xl p-8 border border-[#e6e1db] dark:border-[#3a2e22] shadow-sm flex flex-col md:flex-row items-center gap-8 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-primary to-yellow-300"></div>
            <div
                class="flex-shrink-0 bg-yellow-100 dark:bg-yellow-900/20 rounded-full p-6 text-yellow-600 dark:text-yellow-400">
                <span class="material-symbols-outlined text-5xl">trophy</span>
            </div>
            <div class="flex-grow text-center md:text-left">
                <h3 class="text-2xl font-bold text-text-main dark:text-white">Chu·ªói ho√†n th√†nh tu·∫ßn! üî•</h3>
                <p class="text-text-muted dark:text-[#a89880] mt-1" id="weekly-streak-desc">ƒêang t√≠nh to√°n chu·ªói c·ªßa
                    con...</p>
            </div>
            <div class="flex gap-2" id="weekly-log-container">
                <!-- Dynamic Content -->
            </div>
        </div>
    </main>
    <!-- Bottom Navigation -->
    <child-nav active="dashboard"></child-nav>

    <!-- Floating Parent Mode Button -->
    <div class="fixed bottom-28 right-6 z-40">
        <button onclick="window.openParentPinModal()"
            class="bg-[#2c2215] dark:bg-white text-white dark:text-[#2c2215] px-6 py-3 rounded-full font-bold shadow-lg hover:shadow-xl hover:scale-105 transition-all flex items-center gap-3 border-2 border-transparent focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
            <span class="text-sm">Ch·∫ø ƒë·ªô Ph·ª• huynh</span>
            <span class="material-symbols-outlined text-xl">lock</span>
        </button>
    </div>

    <parent-pin-modal></parent-pin-modal>



    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (window.AppState) {
                const renderHeaderCount = (data) => {
                    const pendingCount = data.quests.filter(q => !(q.completedBy && q.completedBy.includes(data.user.id))).length;
                    const greetingEl = document.getElementById('task-greeting-count');

                    if (greetingEl) {
                        if (pendingCount > 0) {
                            greetingEl.innerHTML = `Con c√≤n <span class="text-primary font-bold">${pendingCount} nhi·ªám v·ª•</span> ƒë·ªÉ chinh ph·ª•c h√¥m nay.`;
                        } else {
                            greetingEl.innerHTML = `L√†m t·ªët l·∫Øm! Con ƒë√£ ho√†n th√†nh t·∫•t c·∫£ nhi·ªám v·ª• h√¥m nay.`;
                        }
                    }

                    // Update Name
                    const nameEl = document.getElementById('user-greeting-name');
                    if (nameEl) nameEl.innerText = data.user.name;

                    // Update Streaks
                    const actionStreakEl = document.getElementById('stat-action-streak');
                    const completionStreakEl = document.getElementById('stat-completion-streak');
                    if (actionStreakEl && data.user.actionStreak !== undefined) actionStreakEl.innerText = data.user.actionStreak;
                    if (completionStreakEl && data.user.completionStreak !== undefined) completionStreakEl.innerText = data.user.completionStreak;

                    // Update Weekly Progress UI
                    const weeklyProgressSection = document.getElementById('weekly-progress-section');
                    if (weeklyProgressSection && data.user.weeklyLog) {
                        const streakText = weeklyProgressSection.querySelector('#weekly-streak-desc');
                        if (streakText) {
                            streakText.innerHTML = `Con ƒë√£ ho√†n th√†nh m·ªçi vi·ªác trong <span class="text-primary font-bold">${data.user.completionStreak || 0} ng√†y</span> li√™n ti·∫øp. C·ªë l√™n ƒë·ªÉ nh·∫≠n Si√™u Th∆∞·ªüng nh√©!`;
                        }

                        const logContainer = weeklyProgressSection.querySelector('#weekly-log-container');
                        if (logContainer) {
                            const days = ['M', 'T', 'W', 'T', 'F', 'S', 'S'];
                            const log = data.user.weeklyLog; // Array of 7 booleans

                            logContainer.innerHTML = days.map((day, i) => {
                                const isDone = log[i];
                                return `
                                    <div class="flex flex-col items-center gap-1">
                                        <div class="h-10 w-10 rounded-full ${isDone ? 'bg-green-500 text-white shadow-sm' : 'bg-gray-200 dark:bg-gray-700 text-gray-400 dark:text-gray-500 border-2 border-dashed border-gray-300 dark:border-gray-600'} flex items-center justify-center transition-all duration-500">
                                            ${isDone ? '<span class="material-symbols-outlined text-sm">check</span>' : ''}
                                        </div>
                                        <span class="text-xs font-bold ${isDone ? 'text-green-600 dark:text-green-400' : 'text-text-muted'}">${day}</span>
                                    </div>
                                `;
                            }).join('');
                        }
                    }
                };

                window.AppState.subscribe(renderHeaderCount);
                renderHeaderCount(window.AppState.data);
            }
        });
    </script>
</body>

</html>