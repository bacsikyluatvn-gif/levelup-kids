<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Bộ Sưu Tập - LevelUp Kids</title>
    <link rel="stylesheet" href="../shared/css/global.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../shared/js/state.js"></script>
    <script src="../shared/js/components.js" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ee9d2b",
                        "primary-dark": "#d48215",
                        "text-main": "#181511",
                        "text-muted": "#897961"
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }

        @keyframes floatIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .float-in {
            animation: floatIn 0.5s ease-out both;
        }

        .float-in-delay-1 {
            animation-delay: 0.1s;
        }

        .float-in-delay-2 {
            animation-delay: 0.2s;
        }

        .float-in-delay-3 {
            animation-delay: 0.3s;
        }

        .float-in-delay-4 {
            animation-delay: 0.4s;
        }

        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }

            100% {
                background-position: 200% 0;
            }
        }

        .shimmer-border {
            background: linear-gradient(90deg, transparent 0%, rgba(238, 157, 43, 0.4) 50%, transparent 100%);
            background-size: 200% 100%;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(238, 157, 43, 0.3);
            }

            50% {
                box-shadow: 0 0 25px 5px rgba(238, 157, 43, 0.15);
            }
        }

        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        @keyframes spin-slow {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .spin-slow {
            animation: spin-slow 8s linear infinite;
        }

        .title-card-unlocked {
            transition: all 0.3s ease;
        }

        .title-card-unlocked:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px -12px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>

<body class="bg-slate-50 dark:bg-[#221a10] text-text-main min-h-screen flex flex-col">

    <app-header title="Bộ Sưu Tập" type="child"></app-header>

    <main class="flex-grow w-full max-w-[900px] mx-auto p-6 md:p-8 pb-32 space-y-10">

        <!-- Hero Section -->
        <section id="hero-section" class="float-in">
            <div
                class="relative bg-gradient-to-br from-purple-600 via-indigo-600 to-blue-700 rounded-[2rem] p-8 md:p-10 overflow-hidden shadow-xl">
                <!-- Decorative elements -->
                <div class="absolute top-0 right-0 w-48 h-48 bg-white/5 rounded-full -translate-y-1/2 translate-x-1/2">
                </div>
                <div
                    class="absolute bottom-0 left-0 w-32 h-32 bg-white/5 rounded-full translate-y-1/2 -translate-x-1/2">
                </div>
                <div class="absolute top-6 right-8 opacity-10">
                    <span class="material-symbols-outlined text-[120px] text-white spin-slow"
                        style="font-variation-settings:'FILL' 1">workspace_premium</span>
                </div>

                <div class="relative z-10 flex flex-col md:flex-row items-center gap-6 md:gap-8">
                    <!-- Current Title Badge -->
                    <div class="flex-shrink-0">
                        <div id="current-badge"
                            class="w-28 h-28 md:w-32 md:h-32 rounded-full bg-white/10 backdrop-blur-sm border-4 border-white/20 flex items-center justify-center pulse-glow">
                            <span id="current-icon" class="material-symbols-outlined text-6xl text-white/90"
                                style="font-variation-settings:'FILL' 1">emoji_events</span>
                        </div>
                    </div>

                    <div class="text-center md:text-left flex-1">
                        <p class="text-purple-200 text-xs font-bold uppercase tracking-[0.2em] mb-2">Danh hiệu hiện tại
                        </p>
                        <h1 id="current-title" class="text-3xl md:text-4xl font-black text-white mb-2 tracking-tight">
                            Đang tải...</h1>
                        <p id="sticker-count" class="text-purple-200 text-sm font-medium mb-4">
                            Đã thu thập <span class="text-white font-black">—</span> Huy hiệu
                        </p>

                        <!-- Progress to next -->
                        <div id="next-progress" class="hidden">
                            <div class="flex items-center justify-between text-xs font-bold text-purple-200 mb-2">
                                <span>Tiến độ đến danh hiệu tiếp theo</span>
                                <span id="next-progress-text" class="text-white">0 / 10</span>
                            </div>
                            <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden backdrop-blur-sm">
                                <div id="next-progress-bar"
                                    class="h-full bg-gradient-to-r from-yellow-300 to-primary rounded-full transition-all duration-1000 ease-out"
                                    style="width: 0%"></div>
                            </div>
                            <p id="next-title-name" class="text-xs text-purple-300 mt-2 font-medium">
                                Mục tiêu: <span class="text-white font-bold">—</span>
                            </p>
                        </div>

                        <!-- Max level -->
                        <div id="max-level-badge" class="hidden">
                            <div
                                class="inline-flex items-center gap-2 bg-white/10 backdrop-blur-sm text-white text-sm font-bold px-4 py-2 rounded-full border border-white/20">
                                <span class="material-symbols-outlined text-yellow-300"
                                    style="font-variation-settings:'FILL' 1">auto_awesome</span>
                                Đã đạt cấp cao nhất!
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stats Row -->
        <section class="grid grid-cols-2 sm:grid-cols-4 gap-4 float-in float-in-delay-1">
            <div
                class="bg-white dark:bg-slate-900 rounded-2xl p-5 border border-slate-100 dark:border-slate-800 shadow-sm text-center">
                <div
                    class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-xl flex items-center justify-center mx-auto mb-2">
                    <span class="material-symbols-outlined text-purple-500 text-xl"
                        style="font-variation-settings:'FILL' 1">sell</span>
                </div>
                <p id="stat-total-stickers" class="text-2xl font-black text-slate-800 dark:text-white">—</p>
                <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wider mt-1">Tổng huy hiệu</p>
            </div>
            <div
                class="bg-white dark:bg-slate-900 rounded-2xl p-5 border border-slate-100 dark:border-slate-800 shadow-sm text-center">
                <div
                    class="w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center mx-auto mb-2">
                    <span class="material-symbols-outlined text-amber-500 text-xl"
                        style="font-variation-settings:'FILL' 1">workspace_premium</span>
                </div>
                <p id="stat-unlocked" class="text-2xl font-black text-slate-800 dark:text-white">0</p>
                <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wider mt-1">Đã mở khóa</p>
            </div>
            <div
                class="bg-white dark:bg-slate-900 rounded-2xl p-5 border border-slate-100 dark:border-slate-800 shadow-sm text-center">
                <div
                    class="w-10 h-10 bg-slate-100 dark:bg-slate-800 rounded-xl flex items-center justify-center mx-auto mb-2">
                    <span class="material-symbols-outlined text-slate-400 text-xl">lock</span>
                </div>
                <p id="stat-locked" class="text-2xl font-black text-slate-800 dark:text-white">0</p>
                <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wider mt-1">Chưa mở</p>
            </div>
            <div
                class="bg-white dark:bg-slate-900 rounded-2xl p-5 border border-slate-100 dark:border-slate-800 shadow-sm text-center">
                <div
                    class="w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center mx-auto mb-2">
                    <span class="material-symbols-outlined text-green-500 text-xl"
                        style="font-variation-settings:'FILL' 1">trending_up</span>
                </div>
                <p id="stat-level" class="text-2xl font-black text-slate-800 dark:text-white">—</p>
                <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wider mt-1">Cấp độ</p>
            </div>
        </section>

        <!-- Title Cards -->
        <section class="float-in float-in-delay-2">
            <div class="flex items-center gap-3 mb-6">
                <div class="bg-gradient-to-br from-purple-500 to-indigo-600 p-2.5 rounded-xl text-white shadow-lg">
                    <span class="material-symbols-outlined text-xl">military_tech</span>
                </div>
                <div>
                    <h2 class="text-2xl font-black text-slate-800 dark:text-white">Tất Cả Danh Hiệu</h2>
                    <p class="text-sm text-slate-500 dark:text-slate-400">Hoàn thành nhiệm vụ để thu thập huy hiệu và mở
                        khóa!</p>
                </div>
            </div>

            <div id="titles-container" class="space-y-5">
                <!-- Rendered by JS -->
            </div>
        </section>

        <!-- How it works -->
        <section class="float-in float-in-delay-3">
            <div
                class="bg-white dark:bg-slate-900 rounded-[2rem] p-8 border border-slate-100 dark:border-slate-800 shadow-sm">
                <h3 class="text-xl font-black text-slate-800 dark:text-white mb-6 flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary"
                        style="font-variation-settings:'FILL' 1">help</span>
                    Làm sao để mở khóa danh hiệu?
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                    <div class="text-center">
                        <div
                            class="w-16 h-16 bg-blue-100 dark:bg-blue-900/20 rounded-2xl flex items-center justify-center mx-auto mb-3">
                            <span class="material-symbols-outlined text-blue-500 text-3xl"
                                style="font-variation-settings:'FILL' 1">task_alt</span>
                        </div>
                        <h4 class="font-bold text-slate-800 dark:text-white mb-1">Hoàn thành nhiệm vụ</h4>
                        <p class="text-xs text-slate-500">Mỗi nhiệm vụ hoàn thành sẽ nhận được Huy hiệu (Sticker)</p>
                    </div>
                    <div class="text-center">
                        <div
                            class="w-16 h-16 bg-purple-100 dark:bg-purple-900/20 rounded-2xl flex items-center justify-center mx-auto mb-3">
                            <span class="material-symbols-outlined text-purple-500 text-3xl transform rotate-12"
                                style="font-variation-settings:'FILL' 1">sell</span>
                        </div>
                        <h4 class="font-bold text-slate-800 dark:text-white mb-1">Tích lũy Huy hiệu</h4>
                        <p class="text-xs text-slate-500">Tổng số huy hiệu tích lũy sẽ được tính (kể cả đã dùng đổi quà)
                        </p>
                    </div>
                    <div class="text-center">
                        <div
                            class="w-16 h-16 bg-amber-100 dark:bg-amber-900/20 rounded-2xl flex items-center justify-center mx-auto mb-3">
                            <span class="material-symbols-outlined text-amber-500 text-3xl"
                                style="font-variation-settings:'FILL' 1">workspace_premium</span>
                        </div>
                        <h4 class="font-bold text-slate-800 dark:text-white mb-1">Mở khóa danh hiệu</h4>
                        <p class="text-xs text-slate-500">Đạt đủ mốc sẽ tự động nhận danh hiệu mới!</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <child-nav active="titles"></child-nav>

    <script>
        const colorMap = {
            slate: { bg: 'from-slate-400 to-slate-600', iconBg: 'bg-slate-100 dark:bg-slate-800', text: 'text-slate-600 dark:text-slate-400' },
            lime: { bg: 'from-lime-400 to-green-500', iconBg: 'bg-lime-100 dark:bg-lime-900/30', text: 'text-lime-600 dark:text-lime-400' },
            green: { bg: 'from-green-400 to-green-600', iconBg: 'bg-green-100 dark:bg-green-900/30', text: 'text-green-600 dark:text-green-400' },
            teal: { bg: 'from-teal-400 to-teal-600', iconBg: 'bg-teal-100 dark:bg-teal-900/30', text: 'text-teal-600 dark:text-teal-400' },
            emerald: { bg: 'from-emerald-400 to-teal-500', iconBg: 'bg-emerald-100 dark:bg-emerald-900/30', text: 'text-emerald-600 dark:text-emerald-400' },
            cyan: { bg: 'from-cyan-400 to-cyan-600', iconBg: 'bg-cyan-100 dark:bg-cyan-900/30', text: 'text-cyan-600 dark:text-cyan-400' },
            sky: { bg: 'from-sky-400 to-sky-600', iconBg: 'bg-sky-100 dark:bg-sky-900/30', text: 'text-sky-600 dark:text-sky-400' },
            blue: { bg: 'from-blue-400 to-indigo-500', iconBg: 'bg-blue-100 dark:bg-blue-900/30', text: 'text-blue-600 dark:text-blue-400' },
            indigo: { bg: 'from-indigo-400 to-indigo-600', iconBg: 'bg-indigo-100 dark:bg-indigo-900/30', text: 'text-indigo-600 dark:text-indigo-400' },
            purple: { bg: 'from-purple-400 to-purple-600', iconBg: 'bg-purple-100 dark:bg-purple-900/30', text: 'text-purple-600 dark:text-purple-400' },
            violet: { bg: 'from-violet-400 to-violet-600', iconBg: 'bg-violet-100 dark:bg-violet-900/30', text: 'text-violet-600 dark:text-violet-400' },
            pink: { bg: 'from-pink-400 to-pink-600', iconBg: 'bg-pink-100 dark:bg-pink-900/30', text: 'text-pink-600 dark:text-pink-400' },
            rose: { bg: 'from-rose-400 to-red-500', iconBg: 'bg-rose-100 dark:bg-rose-900/30', text: 'text-rose-600 dark:text-rose-400' },
            amber: { bg: 'from-amber-400 to-orange-500', iconBg: 'bg-amber-100 dark:bg-amber-900/30', text: 'text-amber-600 dark:text-amber-400' },
            orange: { bg: 'from-orange-400 to-orange-600', iconBg: 'bg-orange-100 dark:bg-orange-900/30', text: 'text-orange-600 dark:text-orange-400' },
            red: { bg: 'from-red-500 to-red-700', iconBg: 'bg-red-100 dark:bg-red-900/30', text: 'text-red-600 dark:text-red-400' },
        };

        function renderTitles(data) {
            if (!data || !window.TITLE_MILESTONES) return;

            const totalStickers = data.user.totalStickers || 0;
            const currentTitleIndex = data.title.currentTitleIndex;
            const milestones = window.TITLE_MILESTONES;

            // Update hero section
            if (currentTitleIndex >= 0) {
                const current = milestones[currentTitleIndex];
                const c = colorMap[current.color] || colorMap['slate'];
                document.getElementById('current-title').textContent = current.name;
                document.getElementById('current-icon').textContent = current.icon;
            } else {
                document.getElementById('current-title').textContent = 'Chưa có danh hiệu';
                document.getElementById('current-icon').textContent = 'lock_open';
            }

            document.getElementById('sticker-count').innerHTML =
                `Đã thu thập <span class="text-white font-black">${totalStickers}</span> Huy hiệu`;

            // Next progress
            const nextIndex = currentTitleIndex + 1;
            const nextProgressEl = document.getElementById('next-progress');
            const maxLevelEl = document.getElementById('max-level-badge');

            if (nextIndex < milestones.length) {
                nextProgressEl.classList.remove('hidden');
                maxLevelEl.classList.add('hidden');

                const nextMilestone = milestones[nextIndex];
                const prevStickers = nextIndex === 0 ? 0 : milestones[nextIndex - 1].stickers;
                const range = nextMilestone.stickers - prevStickers;
                const progress = Math.max(0, totalStickers - prevStickers);
                const pct = Math.min(100, (progress / range) * 100);

                document.getElementById('next-progress-text').textContent = `${totalStickers} / ${nextMilestone.stickers}`;
                document.getElementById('next-progress-bar').style.width = pct + '%';
                document.getElementById('next-title-name').innerHTML =
                    `Mục tiêu: <span class="text-white font-bold">${nextMilestone.name}</span>`;
            } else {
                nextProgressEl.classList.add('hidden');
                maxLevelEl.classList.remove('hidden');
            }

            // Stats
            const unlockedCount = currentTitleIndex + 1;
            document.getElementById('stat-total-stickers').textContent = totalStickers;
            document.getElementById('stat-unlocked').textContent = unlockedCount;
            document.getElementById('stat-locked').textContent = milestones.length - unlockedCount;
            document.getElementById('stat-level').textContent = data.user.level || 1;

            // Render title cards
            const container = document.getElementById('titles-container');
            let html = '';

            milestones.forEach((m, index) => {
                const c = colorMap[m.color] || colorMap['slate'];
                const isUnlocked = index <= currentTitleIndex;
                const isCurrent = index === currentTitleIndex;
                const isNext = index === currentTitleIndex + 1;
                const isLocked = index > currentTitleIndex + 1;

                // Calculate progress for the next milestone
                let progressHTML = '';
                if (isNext) {
                    const prevStickers = index === 0 ? 0 : milestones[index - 1].stickers;
                    const range = m.stickers - prevStickers;
                    const progress = Math.max(0, totalStickers - prevStickers);
                    const pct = Math.min(100, (progress / range) * 100);
                    const remaining = m.stickers - totalStickers;

                    progressHTML = `
                        <div class="mt-5 pt-5 border-t border-slate-100 dark:border-slate-700/50">
                            <div class="flex justify-between text-xs font-bold mb-2">
                                <span class="text-slate-500">Tiến độ</span>
                                <span class="text-purple-600 dark:text-purple-400">${totalStickers} / ${m.stickers} Huy hiệu</span>
                            </div>
                            <div class="w-full bg-slate-100 dark:bg-slate-700 rounded-full h-2.5 overflow-hidden">
                                <div class="bg-gradient-to-r from-purple-400 to-primary h-full rounded-full transition-all duration-1000" style="width: ${pct}%"></div>
                            </div>
                            <p class="text-[11px] text-slate-400 mt-2 font-medium">Cần thêm <span class="font-bold text-purple-500">${remaining}</span> huy hiệu nữa</p>
                        </div>
                    `;
                }

                // Status badge
                let statusBadge = '';
                if (isCurrent) {
                    statusBadge = `
                        <div class="flex items-center gap-1.5 bg-gradient-to-r from-orange-400 to-pink-500 text-white text-[10px] font-black px-3 py-1.5 rounded-full shadow-md">
                            <span class="material-symbols-outlined text-[14px]" style="font-variation-settings:'FILL' 1">auto_awesome</span>
                            ĐANG SỞ HỮU
                        </div>
                    `;
                } else if (isNext) {
                    statusBadge = `
                        <div class="flex items-center gap-1.5 bg-primary/10 text-primary text-[10px] font-black px-3 py-1.5 rounded-full border border-primary/20">
                            <span class="material-symbols-outlined text-[14px]">flag</span>
                            MỤC TIÊU
                        </div>
                    `;
                } else if (isUnlocked) {
                    statusBadge = `
                        <div class="flex items-center gap-1.5 bg-green-100 dark:bg-green-900/20 text-green-600 text-[10px] font-black px-3 py-1.5 rounded-full border border-green-200 dark:border-green-800">
                            <span class="material-symbols-outlined text-[14px]" style="font-variation-settings:'FILL' 1">check_circle</span>
                            ĐÃ ĐẠT
                        </div>
                    `;
                } else {
                    statusBadge = `
                        <div class="flex items-center gap-1.5 bg-slate-100 dark:bg-slate-800 text-slate-400 text-[10px] font-black px-3 py-1.5 rounded-full">
                            <span class="material-symbols-outlined text-[14px]">lock</span>
                            CHƯA MỞ
                        </div>
                    `;
                }

                // Card styling
                let cardClass, iconAreaClass, iconStyle;
                if (isCurrent) {
                    cardClass = `bg-white dark:bg-slate-900 rounded-[1.5rem] p-6 md:p-7 border-2 border-primary/30 shadow-lg title-card-unlocked relative overflow-hidden pulse-glow`;
                    iconAreaClass = `w-16 h-16 md:w-20 md:h-20 rounded-2xl bg-gradient-to-br ${c.bg} flex items-center justify-center shadow-lg`;
                    iconStyle = `style="font-variation-settings:'FILL' 1"`;
                } else if (isUnlocked) {
                    cardClass = `bg-white dark:bg-slate-900 rounded-[1.5rem] p-6 md:p-7 border border-slate-100 dark:border-slate-800 shadow-sm title-card-unlocked relative overflow-hidden`;
                    iconAreaClass = `w-16 h-16 md:w-20 md:h-20 rounded-2xl ${c.iconBg} flex items-center justify-center shadow-sm`;
                    iconStyle = `style="font-variation-settings:'FILL' 1"`;
                } else if (isNext) {
                    cardClass = `bg-white dark:bg-slate-900 rounded-[1.5rem] p-6 md:p-7 border-2 border-dashed border-primary/30 shadow-sm relative overflow-hidden`;
                    iconAreaClass = `w-16 h-16 md:w-20 md:h-20 rounded-2xl bg-slate-100 dark:bg-slate-800 flex items-center justify-center`;
                    iconStyle = `style="font-variation-settings:'FILL' 1"`;
                } else {
                    cardClass = `bg-slate-50 dark:bg-slate-900/50 rounded-[1.5rem] p-6 md:p-7 border border-slate-100 dark:border-slate-800 relative overflow-hidden opacity-60`;
                    iconAreaClass = `w-16 h-16 md:w-20 md:h-20 rounded-2xl bg-slate-200 dark:bg-slate-700 flex items-center justify-center`;
                    iconStyle = '';
                }

                const iconColorClass = (isUnlocked || isCurrent) ? 'text-white' : (isNext ? c.text : 'text-slate-400');
                const nameColorClass = (isUnlocked || isCurrent) ? c.text : 'text-slate-500 dark:text-slate-400';

                html += `
                    <div class="${cardClass} float-in" style="animation-delay: ${0.1 + index * 0.08}s">
                        ${isCurrent ? `<div class="absolute top-0 left-0 right-0 h-1 shimmer-border"></div>` : ''}
                        
                        <div class="flex items-center gap-5">
                            <!-- Icon -->
                            <div class="flex-shrink-0">
                                <div class="${iconAreaClass}">
                                    <span class="material-symbols-outlined ${isCurrent || isUnlocked ? 'text-white' : iconColorClass} text-3xl md:text-4xl" ${iconStyle}>${m.icon}</span>
                                </div>
                            </div>

                            <!-- Info -->
                            <div class="flex-grow min-w-0">
                                <div class="flex items-center gap-3 mb-1 flex-wrap">
                                    <h3 class="text-xl md:text-2xl font-black ${nameColorClass} leading-tight">${m.name}</h3>
                                    ${statusBadge}
                                </div>
                                <div class="flex items-center gap-2 text-sm font-bold ${isUnlocked || isCurrent || isNext ? 'text-slate-600 dark:text-slate-300' : 'text-slate-400'}">
                                    <span>Yêu cần đạt:</span>
                                    <span class="material-symbols-outlined text-[14px] text-purple-400 rotate-12" style="font-variation-settings:'FILL' 1">sell</span>
                                    <span class="${isUnlocked || isCurrent ? 'text-purple-600 dark:text-purple-400 font-black' : ''}">${m.stickers} Huy hiệu</span>
                                </div>
                            </div>

                            <!-- Number -->
                            <div class="flex-shrink-0 hidden sm:flex">
                                <div class="w-12 h-12 rounded-full ${(isUnlocked || isCurrent) ? `bg-gradient-to-br ${c.bg} text-white` : 'bg-slate-100 dark:bg-slate-800 text-slate-400'} flex items-center justify-center font-black text-lg">
                                    ${index + 1}
                                </div>
                            </div>
                        </div>

                        ${progressHTML}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            if (window.AppState) {
                window.AppState.subscribe(renderTitles);
                renderTitles(window.AppState.data);
            }
        });
    </script>
</body>

</html>