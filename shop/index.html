<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>C·ª≠a H√†ng - LevelUp Kids</title>
    <link rel="stylesheet" href="../shared/css/global.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../shared/js/state.js"></script>
    <script src="../shared/js/components.js?v=1.0.8" defer></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: { "primary": "#ee9d2b", "primary-dark": "#d48215", "text-main": "#181511", "text-muted": "#897961" }
                }
            }
        }
    </script>
</head>

<body class="bg-slate-50 dark:bg-[#221a10] font-['Montserrat'] text-text-main min-h-screen flex flex-col">

    <app-header title="C·ª≠a H√†ng" type="child"></app-header>

    <main class="flex-grow w-full max-w-[1200px] mx-auto p-6 md:p-8 pb-32 space-y-14">

        <!-- Page Header -->
        <div
            class="flex flex-col items-center justify-center text-center gap-2 mb-10 w-full animate-in slide-in-from-top-4 duration-500">
            <h1
                class="text-4xl md:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-orange-500 to-rose-500 mb-2 tracking-tight drop-shadow-sm pb-1">
                C·ª≠a H√†ng Anh H√πng Nh√≠</h1>
            <p class="text-slate-500 font-medium text-base">N∆°i ƒë·ªïi ph·∫ßn th∆∞·ªüng cho s·ª± n·ªó l·ª±c v√† t√≠nh c√°ch tuy·ªát v·ªùi c·ªßa
                con!</p>
        </div>

        <!-- Balances Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-10 w-full">
            <!-- Personality Points -->
            <div id="personality-badge"
                class="bg-gradient-to-br from-rose-400 to-pink-500 p-5 rounded-3xl shadow-lg shadow-rose-500/20 text-white flex items-center justify-start gap-4 relative overflow-hidden group w-full">
                <div
                    class="absolute -right-4 -bottom-4 opacity-10 group-hover:scale-110 transition-transform duration-500 rotate-12">
                    <span class="material-symbols-outlined text-8xl"
                        style="font-variation-settings:'FILL' 1">favorite</span>
                </div>
                <div class="bg-white/20 p-3 rounded-2xl backdrop-blur-sm shrink-0">
                    <span class="material-symbols-outlined text-3xl font-black block"
                        style="font-variation-settings:'FILL' 1">favorite</span>
                </div>
                <div class="z-10 flex flex-col justify-center">
                    <p class="text-[10px] md:text-xs font-black uppercase tracking-widest text-white/80 mb-0.5">Nh√¢n
                        C√°ch</p>
                    <p id="personality-display" class="text-3xl font-black leading-none tracking-tighter">---</p>
                </div>
            </div>

            <!-- Gold -->
            <div id="gold-badge"
                class="bg-gradient-to-br from-amber-400 to-orange-500 p-5 rounded-3xl shadow-lg shadow-amber-500/20 text-white flex items-center justify-start gap-4 relative overflow-hidden group w-full">
                <div
                    class="absolute -right-4 -bottom-4 opacity-10 group-hover:scale-110 transition-transform duration-500 rotate-12">
                    <span class="material-symbols-outlined text-8xl"
                        style="font-variation-settings:'FILL' 1">monetization_on</span>
                </div>
                <div class="bg-white/20 p-3 rounded-2xl backdrop-blur-sm shrink-0">
                    <span class="material-symbols-outlined text-3xl font-black block"
                        style="font-variation-settings:'FILL' 1">monetization_on</span>
                </div>
                <div class="z-10 flex flex-col justify-center">
                    <p class="text-[10px] md:text-xs font-black uppercase tracking-widest text-white/80 mb-0.5">S·ªë V√†ng
                    </p>
                    <p id="gold-display" class="text-3xl font-black leading-none tracking-tighter">---</p>
                </div>
            </div>

            <!-- Stickers -->
            <div id="sticker-badge"
                class="bg-gradient-to-br from-purple-400 to-indigo-500 p-5 rounded-3xl shadow-lg shadow-purple-500/20 text-white flex items-center justify-start gap-4 relative overflow-hidden group w-full">
                <div
                    class="absolute -right-4 -bottom-4 opacity-10 group-hover:scale-110 transition-transform duration-500 rotate-12">
                    <span class="material-symbols-outlined text-8xl"
                        style="font-variation-settings:'FILL' 1">sell</span>
                </div>
                <div class="bg-white/20 p-3 rounded-2xl backdrop-blur-sm shrink-0">
                    <span class="material-symbols-outlined text-3xl font-black block transform rotate-12"
                        style="font-variation-settings:'FILL' 1">sell</span>
                </div>
                <div class="z-10 flex flex-col justify-center">
                    <p class="text-[10px] md:text-xs font-black uppercase tracking-widest text-white/80 mb-0.5">Huy Hi·ªáu
                    </p>
                    <p id="sticker-display" class="text-3xl font-black leading-none tracking-tighter">---</p>
                </div>
            </div>
        </div>

        <!-- Tab Navigation (Centered, Sleek) -->
        <div class="flex justify-center mb-10 w-full overflow-x-auto hide-scrollbar">
            <div
                class="inline-flex gap-2 bg-slate-100 dark:bg-slate-800 p-1.5 rounded-2xl shadow-inner whitespace-nowrap overflow-x-auto min-w-max md:min-w-0">
                <button onclick="switchShopTab('power')" id="tab-btn-power"
                    class="tab-btn flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-bold text-sm transition-all sm:min-w-[180px] bg-white dark:bg-[#2c2215] shadow-sm text-rose-500">
                    <span class="material-symbols-outlined text-xl"
                        style="font-variation-settings:'FILL' 1">favorite</span>
                    <span>ƒê·∫∑c Quy·ªÅn ‚ú®</span>
                </button>
                <button onclick="switchShopTab('premium')" id="tab-btn-premium"
                    class="tab-btn flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-bold text-sm transition-all sm:min-w-[180px] bg-white dark:bg-[#2c2215] shadow-sm text-amber-500">
                    <span class="material-symbols-outlined text-xl">redeem</span>
                    <span>Qu√† T·∫∑ng üéÅ</span>
                </button>
                <button onclick="switchShopTab('instant')" id="tab-btn-instant"
                    class="tab-btn flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-bold text-sm transition-all sm:min-w-[180px] text-slate-500 hover:text-slate-800 dark:hover:text-white">
                    <span class="material-symbols-outlined text-xl transform rotate-12"
                        style="font-variation-settings:'FILL' 1">sell</span>
                    <span>Ph·∫ßn Th∆∞·ªüng üèÜ</span>
                </button>
            </div>
        </div>

        <!-- Tabs Content -->
        <div class="mt-4">
            <!-- ‚îÄ‚îÄ TAB: Power Cards (Nh√¢n C√°ch) ‚îÄ‚îÄ -->
            <div id="shop-tab-power"
                class="shop-tab-content block animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8">
                    <div class="flex items-center gap-4">
                        <div
                            class="size-16 bg-rose-100 dark:bg-rose-900/30 rounded-2xl flex items-center justify-center text-rose-500 shadow-sm border border-rose-200 dark:border-rose-800">
                            <span class="material-symbols-outlined text-3xl"
                                style="font-variation-settings:'FILL' 1">favorite</span>
                        </div>
                        <div>
                            <h2 class="text-3xl font-black text-slate-800 dark:text-white mb-1">ƒê·∫∑c Quy·ªÅn Y√™u Th∆∞∆°ng
                            </h2>
                            <p class="text-slate-500 font-medium">Nh·ªØng m√≥n qu√† tinh th·∫ßn gi√∫p g·∫Øn k·∫øt con v√† ba m·∫π!</p>
                        </div>
                    </div>
                    <button onclick="window.openGlobalRewardHistoryModal && window.openGlobalRewardHistoryModal()"
                        class="bg-white dark:bg-[#2c2215] hover:bg-slate-50 dark:hover:bg-white/5 text-slate-500 dark:text-slate-400 font-bold px-4 py-2.5 rounded-xl flex items-center justify-center gap-2 transition-all shadow-sm border border-slate-200 dark:border-slate-800 active:scale-95 text-sm w-full sm:w-auto shrink-0">
                        <span class="material-symbols-outlined text-lg">history</span> L·ªãch s·ª≠ ƒê·ªïi Qu√†
                    </button>
                </div>
                <!-- Request personality component with proper attribute tracking -->
                <shop-grid category="personality"></shop-grid>
            </div>

            <!-- ‚îÄ‚îÄ TAB: Premium Shop (V√†ng) ‚îÄ‚îÄ -->
            <div id="shop-tab-premium"
                class="shop-tab-content hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8">
                    <div class="flex items-center gap-4">
                        <div
                            class="size-16 bg-amber-100 dark:bg-amber-900/30 rounded-2xl flex items-center justify-center text-amber-500 shadow-sm border border-amber-200 dark:border-amber-800">
                            <span class="material-symbols-outlined text-3xl">redeem</span>
                        </div>
                        <div>
                            <h2 class="text-3xl font-black text-slate-800 dark:text-white mb-1">Qu√† T·∫∑ng Tuy·ªát V·ªùi</h2>
                            <p class="text-slate-500 font-medium">Nh·ªØng ƒë·ªì ch∆°i, b√°nh k·∫πo h·∫•p d·∫´n con c√≥ th·ªÉ ƒë·ªïi b·∫±ng s·ª±
                                n·ªó l·ª±c v√† t√≠nh c√°ch t·ªët!</p>
                        </div>
                    </div>
                    <button onclick="window.openGlobalRewardHistoryModal && window.openGlobalRewardHistoryModal()"
                        class="bg-white dark:bg-[#2c2215] hover:bg-slate-50 dark:hover:bg-white/5 text-slate-500 dark:text-slate-400 font-bold px-4 py-2.5 rounded-xl flex items-center justify-center gap-2 transition-all shadow-sm border border-slate-200 dark:border-slate-800 active:scale-95 text-sm w-full sm:w-auto shrink-0">
                        <span class="material-symbols-outlined text-lg">history</span> L·ªãch s·ª≠ ƒê·ªïi Qu√†
                    </button>
                </div>
                <shop-grid></shop-grid>
            </div>

            <!-- ‚îÄ‚îÄ TAB: Instant Perks (Stickers) ‚îÄ‚îÄ -->
            <div id="shop-tab-instant"
                class="shop-tab-content hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8">
                    <div class="flex items-center gap-4">
                        <div
                            class="size-16 bg-teal-100 dark:bg-teal-900/30 rounded-2xl flex items-center justify-center text-teal-600 shadow-sm border border-teal-200 dark:border-teal-800">
                            <span class="material-symbols-outlined text-3xl">bolt</span>
                        </div>
                        <div>
                            <h2 class="text-3xl font-black text-slate-800 dark:text-white mb-1">Ph·∫ßn Th∆∞·ªüng Ngay</h2>
                            <p class="text-slate-500 font-medium">ƒê·ªïi tr·ª±c ti·∫øp b·∫±ng Stickers ƒë·ªÉ nh·∫≠n ƒë·∫∑c quy·ªÅn xem TV,
                                ch∆°i game ngay l·∫≠p t·ª©c!</p>
                        </div>
                    </div>
                    <button onclick="window.openGlobalRewardHistoryModal && window.openGlobalRewardHistoryModal()"
                        class="bg-white dark:bg-[#2c2215] hover:bg-slate-50 dark:hover:bg-white/5 text-slate-500 dark:text-slate-400 font-bold px-4 py-2.5 rounded-xl flex items-center justify-center gap-2 transition-all shadow-sm border border-slate-200 dark:border-slate-800 active:scale-95 text-sm w-full sm:w-auto shrink-0">
                        <span class="material-symbols-outlined text-lg">history</span> L·ªãch s·ª≠ ƒê·ªïi Qu√†
                    </button>
                </div>
                <instant-perks-grid></instant-perks-grid>
            </div>
        </div>

    </main>

    <!-- ‚îÄ‚îÄ Instant Perk Success Modal ‚îÄ‚îÄ -->
    <div id="perk-modal"
        class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300">
        <div
            class="bg-white dark:bg-[#2c2215] w-full max-w-sm rounded-3xl p-8 text-center shadow-2xl transform scale-90 transition-transform duration-300">
            <div class="text-6xl mb-4" id="perk-emoji">‚ö°</div>
            <h3 class="text-2xl font-black text-slate-800 dark:text-white mb-2">ƒê·∫∑c quy·ªÅn ƒë√£ m·ªü!</h3>
            <p id="perk-modal-title" class="text-lg font-bold text-orange-500 mb-2">10 Ph√∫t ƒêi·ªán Tho·∫°i</p>
            <p class="text-slate-500 dark:text-slate-400 mb-8 text-sm">H√£y b√°o b·ªë/m·∫π ngay ƒë·ªÉ ƒë∆∞·ª£c k√≠ch ho·∫°t nh√©! üéâ</p>
            <button onclick="closePerkModal()"
                class="w-full bg-gradient-to-r from-orange-400 to-pink-500 text-white font-bold py-4 rounded-2xl shadow-lg hover:opacity-90 active:scale-95 transition-all">
                Tuy·ªát qu√°! ‚ú®
            </button>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ Premium Item Request Sent Modal ‚îÄ‚îÄ -->
    <div id="success-modal"
        class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300">
        <div
            class="bg-white dark:bg-[#2c2215] w-full max-w-md rounded-3xl p-8 text-center shadow-2xl transform scale-90 transition-transform duration-300 relative overflow-hidden">
            <div
                class="size-20 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce">
                <span class="material-symbols-outlined text-5xl text-primary">redeem</span>
            </div>
            <h3 class="text-2xl font-black text-slate-800 dark:text-white mb-2 tracking-tight">Y√™u c·∫ßu ƒë√£ g·ª≠i!</h3>
            <p class="text-slate-500 dark:text-slate-400 mb-8">B·ªë/m·∫π s·∫Ω x√°c nh·∫≠n s·ªõm nh√©! H√£y ti·∫øp t·ª•c ho√†n th√†nh nhi·ªám
                v·ª• ƒë·ªÉ ki·∫øm th√™m v√†ng üí™</p>
            <button
                class="w-full bg-primary hover:bg-primary-dark text-white font-bold py-4 rounded-xl shadow-btn-3d active:translate-y-1 active:shadow-none transition-all"
                onclick="document.getElementById('success-modal').classList.add('opacity-0','pointer-events-none');">
                Tuy·ªát qu√°!
            </button>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ Item Detail Modal ‚îÄ‚îÄ -->
    <div id="item-detail-modal"
        class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300">
        <div
            class="bg-white dark:bg-[#1a140d] w-full max-w-lg rounded-3xl overflow-hidden shadow-2xl transform scale-90 transition-transform duration-300 relative border border-slate-100 dark:border-slate-800">
            <button onclick="closeItemDetailModal()"
                class="absolute top-4 right-4 z-10 size-10 bg-black/20 hover:bg-black/40 backdrop-blur-md rounded-full flex items-center justify-center text-white transition-colors">
                <span class="material-symbols-outlined">close</span>
            </button>
            <div id="item-detail-image-container"
                class="w-full h-56 bg-slate-100 dark:bg-slate-800 relative flex items-center justify-center">
                <img id="item-detail-img" src="" alt="" class="w-full h-full object-cover">
                <span id="item-detail-icon"
                    class="material-symbols-outlined text-6xl text-slate-300 hidden">redeem</span>
            </div>
            <div class="p-8">
                <h3 id="item-detail-title" class="text-2xl font-black text-slate-800 dark:text-white mb-4">Item Title
                </h3>
                <div class="bg-slate-50 dark:bg-[#2c2215] p-5 rounded-2xl mb-6">
                    <p id="item-detail-desc"
                        class="text-slate-600 dark:text-slate-300 text-sm leading-relaxed whitespace-pre-wrap">Item
                        description...</p>
                </div>
                <button onclick="closeItemDetailModal()"
                    class="w-full bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-3.5 rounded-xl transition-all">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <reward-history-modal></reward-history-modal>

    <child-nav active="shop"></child-nav>

    <div class="fixed bottom-28 right-6 z-40 hidden md:block">
        <button onclick="window.openParentPinModal()"
            class="bg-[#2c2215] dark:bg-white text-white dark:text-[#2c2215] px-6 py-3 rounded-full font-bold shadow-lg hover:shadow-xl hover:scale-105 transition-all flex items-center gap-3">
            <span class="text-sm">Ch·∫ø ƒë·ªô Ph·ª• huynh</span>
            <span class="material-symbols-outlined text-xl">lock</span>
        </button>
    </div>

    <script>
        // Update display
        function updateDisplay() {
            if (window.AppState) {
                const gold = window.AppState.data.user.gold;
                const stickers = window.AppState.data.user.stickers;
                const personality = window.AppState.data.user.personalityPoints;
                const goldEl = document.getElementById('gold-display');
                const stickerEl = document.getElementById('sticker-display');
                const personalityEl = document.getElementById('personality-display');
                if (goldEl) goldEl.textContent = gold;
                if (stickerEl) stickerEl.textContent = stickers;
                if (personalityEl) personalityEl.textContent = personality;
            }
        }

        // Tab switching
        function switchShopTab(tabId) {
            // Hide all tab content
            document.querySelectorAll('.shop-tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.shop-tab-content').forEach(el => el.classList.remove('block'));

            // Show target content
            const target = document.getElementById(`shop-tab-${tabId}`);
            if (target) {
                target.classList.remove('hidden');
                target.classList.add('block');
            }

            // Reset all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.className = "tab-btn flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-bold text-sm transition-all sm:min-w-[180px] text-slate-500 hover:text-slate-800 dark:hover:text-white";
            });

            // Set active button style
            const activeBtn = document.getElementById(`tab-btn-${tabId}`);
            if (activeBtn) {
                if (tabId === 'power') activeBtn.className = "tab-btn flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-bold text-sm transition-all sm:min-w-[180px] bg-white dark:bg-[#2c2215] shadow-sm text-rose-500";
                else if (tabId === 'premium') activeBtn.className = "tab-btn flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-bold text-sm transition-all sm:min-w-[180px] bg-white dark:bg-[#2c2215] shadow-sm text-amber-500";
                else if (tabId === 'instant') activeBtn.className = "tab-btn flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-bold text-sm transition-all sm:min-w-[180px] bg-white dark:bg-[#2c2215] shadow-sm text-purple-500";
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            if (window.AppState) {
                window.AppState.subscribe(updateDisplay);
                updateDisplay();
            }
        });

        // Perk modal helpers
        function openPerkModal(perk) {
            document.getElementById('perk-emoji').textContent = perk.emoji || '‚ö°';
            document.getElementById('perk-modal-title').textContent = perk.title;
            const modal = document.getElementById('perk-modal');
            modal.classList.remove('opacity-0', 'pointer-events-none');
            modal.querySelector('div').classList.remove('scale-90');
        }
        function closePerkModal() {
            const modal = document.getElementById('perk-modal');
            modal.classList.add('opacity-0', 'pointer-events-none');
        }

        // Redeem instant perk (called from component)
        window.redeemInstantPerk = async function (perkId) {
            const result = await window.AppState.redeemPerk(perkId);
            if (result && typeof result === 'object') {
                openPerkModal(result);
            } else if (result === false) {
                alert('Kh√¥ng ƒë·ªß Huy hi·ªáu (Stickers) ƒë·ªÉ ƒë·ªïi qu√† n√†y!');
            }
        };

        // Item Detail Modal
        window.showItemDetailModal = function (title, desc, image) {
            document.getElementById('item-detail-title').textContent = decodeURIComponent(title);
            document.getElementById('item-detail-desc').textContent = decodeURIComponent(desc);

            const imgEl = document.getElementById('item-detail-img');
            const iconEl = document.getElementById('item-detail-icon');

            if (image && image !== 'null' && image !== 'undefined' && image !== '') {
                imgEl.src = image;
                imgEl.classList.remove('hidden');
                iconEl.classList.add('hidden');
            } else {
                imgEl.classList.add('hidden');
                iconEl.classList.remove('hidden');
            }

            const modal = document.getElementById('item-detail-modal');
            modal.classList.remove('opacity-0', 'pointer-events-none');
            modal.querySelector('div').classList.remove('scale-90');
        };

        function closeItemDetailModal() {
            const modal = document.getElementById('item-detail-modal');
            modal.classList.add('opacity-0', 'pointer-events-none');
        }

        // Redeem premium shop item (called from component)
        window.redeemPremiumItem = async function (itemId) {
            const result = await window.AppState.redeemShopItem(itemId);
            if (result && typeof result === 'object') {
                const modal = document.getElementById('success-modal');
                modal.classList.remove('opacity-0', 'pointer-events-none');
            } else if (result === false) {
                alert('Kh√¥ng ƒë·ªß v√†ng ƒë·ªÉ ƒë·ªïi ph·∫ßn th∆∞·ªüng n√†y!');
            }
        };
    </script>
</body>

</html>