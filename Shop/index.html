<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>C·ª≠a H√†ng Qu√† T·∫∑ng - LevelUp Kids</title>
    <link rel="stylesheet" href="../shared/css/global.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../shared/js/state.js"></script>
    <script src="../shared/js/components.js" defer></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: { "primary": "#ee9d2b", "primary-dark": "#d48215", "text-main": "#181511", "text-muted": "#897961" }
                }
            }
        }
    </script>
</head>

<body class="bg-slate-50 dark:bg-[#221a10] font-['Montserrat'] text-text-main min-h-screen flex flex-col">

    <app-header title="C·ª≠a H√†ng Qu√† T·∫∑ng" type="child"></app-header>

    <main class="flex-grow w-full max-w-[1200px] mx-auto p-6 md:p-8 pb-32 space-y-14">

        <!-- Balances -->
        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
            <div>
                <h1 class="text-4xl font-black text-slate-800 dark:text-white mb-2">ƒê·ªïi Qu√† T·∫∑ng üéÅ</h1>
                <p class="text-slate-500 font-medium text-lg mb-4">D√πng V√†ng v√† Huy hi·ªáu (Sticker) ki·∫øm ƒë∆∞·ª£c ƒë·ªÉ ƒë·ªïi l·∫•y
                    nh·ªØng
                    ph·∫ßn qu√† con th√≠ch nh√©!</p>
                <button onclick="window.openGlobalRewardHistoryModal && window.openGlobalRewardHistoryModal()"
                    class="bg-blue-100 hover:bg-blue-200 dark:bg-blue-900/30 dark:hover:bg-blue-900/50 text-blue-600 dark:text-blue-400 font-bold px-5 py-2.5 rounded-xl flex items-center gap-2 transition-colors cursor-pointer w-max shadow-sm active:scale-95">
                    <span class="material-symbols-outlined text-xl"
                        style="font-variation-settings:'FILL' 1">history</span> L·ªãch s·ª≠ ƒê·ªïi Qu√†
                </button>
            </div>
            <div class="flex gap-3 self-start sm:self-auto">
                <div id="gold-badge"
                    class="flex items-center gap-3 bg-amber-50 dark:bg-amber-900/20 border-2 border-amber-200 dark:border-amber-700 px-5 py-3 rounded-2xl shadow-sm">
                    <span class="material-symbols-outlined text-3xl text-amber-500"
                        style="font-variation-settings:'FILL' 1">monetization_on</span>
                    <div>
                        <p class="text-xs text-amber-600 font-bold uppercase tracking-wider">S·ªë V√†ng</p>
                        <p id="gold-display" class="text-2xl font-black text-amber-600">---</p>
                    </div>
                </div>

                <div id="sticker-badge"
                    class="flex items-center gap-3 bg-purple-50 dark:bg-purple-900/20 border-2 border-purple-200 dark:border-purple-700 px-5 py-3 rounded-2xl shadow-sm">
                    <span class="material-symbols-outlined text-3xl text-purple-500 transform rotate-12"
                        style="font-variation-settings:'FILL' 1">sell</span>
                    <div>
                        <p class="text-xs text-purple-600 font-bold uppercase tracking-wider">Huy Hi·ªáu</p>
                        <p id="sticker-display" class="text-2xl font-black text-purple-600">---</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ SECTION 1: Instant Perks ‚îÄ‚îÄ -->
        <section>
            <div class="flex items-center gap-3 mb-6">
                <div class="bg-gradient-to-br from-orange-400 to-pink-500 p-2.5 rounded-xl text-white shadow-lg">
                    <span class="material-symbols-outlined text-xl">bolt</span>
                </div>
                <div>
                    <h2 class="text-2xl font-black text-slate-800 dark:text-white">Qu√† T·∫∑ng Ngay ‚ö°</h2>
                    <p class="text-sm text-slate-500">ƒê·ªïi tr·ª±c ti·∫øp b·∫±ng <strong class="text-purple-500">Huy hi·ªáu
                            (Stickers)</strong> ‚Äî nh·∫≠n ƒë·∫∑c quy·ªÅn ngay h√¥m nay!</p>
                </div>
            </div>
            <instant-perks-grid></instant-perks-grid>
        </section>

        <!-- ‚îÄ‚îÄ SECTION 2: Premium Shop ‚îÄ‚îÄ -->
        <section>
            <div class="flex items-center gap-3 mb-6">
                <div class="bg-gradient-to-br from-amber-400 to-orange-500 p-2.5 rounded-xl text-white shadow-lg">
                    <span class="material-symbols-outlined text-xl">redeem</span>
                </div>
                <div>
                    <h2 class="text-2xl font-black text-slate-800 dark:text-white">Ph·∫ßn Th∆∞·ªüng L·ªõn üèÜ</h2>
                    <p class="text-sm text-slate-500">T√≠ch l≈©y v√†ng ƒë·ªÉ ƒë·ªïi nh·ªØng ph·∫ßn th∆∞·ªüng ƒë·∫∑c bi·ªát ‚Äî c·∫ßn b·ªë m·∫π x√°c
                        nh·∫≠n.</p>
                </div>
            </div>
            <shop-grid></shop-grid>
        </section>

    </main>

    <!-- ‚îÄ‚îÄ Instant Perk Success Modal ‚îÄ‚îÄ -->
    <div id="perk-modal"
        class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300">
        <div
            class="bg-white dark:bg-[#2c2215] w-full max-w-sm rounded-3xl p-8 text-center shadow-2xl transform scale-90 transition-transform duration-300">
            <div class="text-6xl mb-4" id="perk-emoji">‚ö°</div>
            <h3 class="text-2xl font-black text-slate-800 dark:text-white mb-2">ƒê·∫∑c quy·ªÅn ƒë√£ m·ªü!</h3>
            <p id="perk-modal-title" class="text-lg font-bold text-orange-500 mb-2">10 Ph√∫t ƒêi·ªán Tho·∫°i</p>
            <p class="text-slate-500 dark:text-slate-400 mb-8 text-sm">H√£y b√°o b·ªë/m·∫π ngay ƒë·ªÉ ƒë∆∞·ª£c k√≠ch ho·∫°t nh√©! üéâ</p>
            <button onclick="closePerkModal()"
                class="w-full bg-gradient-to-r from-orange-400 to-pink-500 text-white font-bold py-4 rounded-2xl shadow-lg hover:opacity-90 active:scale-95 transition-all">
                Tuy·ªát qu√°! ‚ú®
            </button>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ Premium Item Request Sent Modal ‚îÄ‚îÄ -->
    <div id="success-modal"
        class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300">
        <div
            class="bg-white dark:bg-[#2c2215] w-full max-w-md rounded-3xl p-8 text-center shadow-2xl transform scale-90 transition-transform duration-300 relative overflow-hidden">
            <div
                class="size-20 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce">
                <span class="material-symbols-outlined text-5xl text-primary">redeem</span>
            </div>
            <h3 class="text-2xl font-black text-slate-800 dark:text-white mb-2 tracking-tight">Y√™u c·∫ßu ƒë√£ g·ª≠i!</h3>
            <p class="text-slate-500 dark:text-slate-400 mb-8">B·ªë/m·∫π s·∫Ω x√°c nh·∫≠n s·ªõm nh√©! H√£y ti·∫øp t·ª•c ho√†n th√†nh nhi·ªám
                v·ª• ƒë·ªÉ ki·∫øm th√™m v√†ng üí™</p>
            <button
                class="w-full bg-primary hover:bg-primary-dark text-white font-bold py-4 rounded-xl shadow-btn-3d active:translate-y-1 active:shadow-none transition-all"
                onclick="document.getElementById('success-modal').classList.add('opacity-0','pointer-events-none');">
                Tuy·ªát qu√°!
            </button>
        </div>
    </div>

    <reward-history-modal></reward-history-modal>

    <child-nav active="shop"></child-nav>

    <div class="fixed bottom-28 right-6 z-40 hidden md:block">
        <button onclick="window.openParentPinModal()"
            class="bg-[#2c2215] dark:bg-white text-white dark:text-[#2c2215] px-6 py-3 rounded-full font-bold shadow-lg hover:shadow-xl hover:scale-105 transition-all flex items-center gap-3">
            <span class="text-sm">Ch·∫ø ƒë·ªô Ph·ª• huynh</span>
            <span class="material-symbols-outlined text-xl">lock</span>
        </button>
    </div>

    <script>
        // Update display
        function updateDisplay() {
            if (window.AppState) {
                const gold = window.AppState.data.user.gold;
                const stickers = window.AppState.data.user.stickers;
                const goldEl = document.getElementById('gold-display');
                const stickerEl = document.getElementById('sticker-display');
                if (goldEl) goldEl.textContent = gold;
                if (stickerEl) stickerEl.textContent = stickers;
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            if (window.AppState) {
                window.AppState.subscribe(updateDisplay);
                updateDisplay();
            }
        });

        // Perk modal helpers
        function openPerkModal(perk) {
            document.getElementById('perk-emoji').textContent = perk.emoji || '‚ö°';
            document.getElementById('perk-modal-title').textContent = perk.title;
            const modal = document.getElementById('perk-modal');
            modal.classList.remove('opacity-0', 'pointer-events-none');
            modal.querySelector('div').classList.remove('scale-90');
        }
        function closePerkModal() {
            const modal = document.getElementById('perk-modal');
            modal.classList.add('opacity-0', 'pointer-events-none');
        }

        // Redeem instant perk (called from component)
        window.redeemInstantPerk = async function (perkId) {
            const result = await window.AppState.redeemPerk(perkId);
            if (result && typeof result === 'object') {
                openPerkModal(result);
            } else if (result === false) {
                alert('Kh√¥ng ƒë·ªß Huy hi·ªáu (Stickers) ƒë·ªÉ ƒë·ªïi qu√† n√†y!');
            }
        };

        // Redeem premium shop item (called from component)
        window.redeemPremiumItem = async function (itemId) {
            const result = await window.AppState.redeemShopItem(itemId);
            if (result && typeof result === 'object') {
                const modal = document.getElementById('success-modal');
                modal.classList.remove('opacity-0', 'pointer-events-none');
            } else if (result === false) {
                alert('Kh√¥ng ƒë·ªß v√†ng ƒë·ªÉ ƒë·ªïi ph·∫ßn th∆∞·ªüng n√†y!');
            }
        };
    </script>
</body>

</html>